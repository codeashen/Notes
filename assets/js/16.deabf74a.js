(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{341:function(t,s,a){"use strict";a.r(s);var r=a(4),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"hystrix介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix介绍"}},[t._v("#")]),t._v(" Hystrix介绍")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix是主要用于处理延迟和容错的开源库")]),t._v(" "),s("li",[t._v("Hystrix主要用于避免级联故障，提高系统弹性")]),t._v(" "),s("li",[t._v("Hystrix解决了由于扇出导致的“雪崩效应”")]),t._v(" "),s("li",[t._v("Hystrix的核心是“隔离术”和“熔断机制”")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/01/DWXDnP.png",alt:"image-20201201101836254"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/01/DWXr0f.png",alt:"image-20201201102015431"}})]),t._v(" "),s("h3",{attrs:{id:"hystrix依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix依赖"}},[t._v("#")]),t._v(" Hystrix依赖")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Hystrix依赖 --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-netflix-hystrix"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-netflix-hystrix-dashboard"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-actuator"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("h3",{attrs:{id:"hystrix主要作用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix主要作用"}},[t._v("#")]),t._v(" Hystrix主要作用")]),t._v(" "),s("ul",[s("li",[t._v("服务隔离和服务熔断")]),t._v(" "),s("li",[t._v("服务降级、限流和快速失败")]),t._v(" "),s("li",[t._v("请求合并和请求缓存")]),t._v(" "),s("li",[t._v("自带单体和集群监控")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/02/DIikKf.png",alt:"Hystrix"}})]),t._v(" "),s("h3",{attrs:{id:"hystrix架构图介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix架构图介绍"}},[t._v("#")]),t._v(" Hystrix架构图介绍")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/01/DWX7AU.png",alt:"Hystrix高层示意图"}})]),t._v(" "),s("ol",[s("li",[s("p",[t._v("构建 HystrixCommand【依赖的服务返回单个的结果】 or HystrixObservableCommand【依赖的服务返回多个操作结果】对象【1】。")])]),t._v(" "),s("li",[s("p",[t._v("执行命令，以下四种方法中的一种【前两种方法仅适用于简单的HystrixCommand对象，而不适用于HystrixObservableCommand】【2】：")]),t._v(" "),s("ol",[s("li",[t._v("execute()，同步，从依赖的服务返回一个单一的响应【或在发生错误的时候抛出异常】。")]),t._v(" "),s("li",[t._v("queue()，返回Future对象，包含了服务执行结束时要返回的单一结果对象。")]),t._v(" "),s("li",[t._v("observe()：返回Observable对象。")]),t._v(" "),s("li",[t._v("toObservable()：返回Observable对象，也代表了操作的多个结果。")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),t._v("             value   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Future")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("     fValue  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("queue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Observable")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" ohValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//hot observable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Observable")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" ocValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toObservable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//cold observable")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("检查缓存【3】，若当前命令的请求缓存功能是被启用的，并且该命令缓存命中，那么这个缓存的响应将立即以Observable形式返回。")])]),t._v(" "),s("li",[s("p",[t._v("检查断路器是否是打开状态【4】，如果断路器打开，则Hystrix不会执行命令，而是处理fallback逻辑【8】，否则检查是否有可用资源来执行命令【5】。")])]),t._v(" "),s("li",[s("p",[t._v("线程池/请求队列/信号量是否已满【5】，如果命令依赖服务的专有线程池和请求队列，或信号量已经被占满，那么Hystrix也不会执行命令，而是转到第【8】步。")])]),t._v(" "),s("li",[s("p",[t._v("Hystrix会根据我们编写的方法来决定采取什么样的方式去请求依赖服务【6】。")]),t._v(" "),s("ol",[s("li",[t._v("HystrixCommand.run()：返回一个单一的结果，或者抛出异常。")]),t._v(" "),s("li",[t._v("HystrixObservableCommand.constract()：返回一个Observable对象来发送多个结果或通过onError发送错误通知。")])])]),t._v(" "),s("li",[s("p",[t._v("Hystrix向断路器报告成功、失败、拒绝和超时等信息，断路器通过维护一组计数器来统计这些数据，通过这些数据来决定是否要打开断路器【7】。")])]),t._v(" "),s("li",[s("p",[t._v("当命令执行失败时，Hystrix会进入fallback尝试回退处理，我们通常称为：服务降级。能够引起服务降级处理的情况：")]),t._v(" "),s("ol",[s("li",[t._v("熔断器打开。【4】")]),t._v(" "),s("li",[t._v("当前命令的线程池、请求队列、信号量被占满的时候。【5】")]),t._v(" "),s("li",[t._v("HystrixCommand.run()或HystrixObservableCommand.constract()抛出异常时。【6】")])])]),t._v(" "),s("li",[s("p",[t._v("当Hystrix命令执行成功之后，它会将处理结果直接返回或是以Observable的形式返回。")])])]),t._v(" "),s("p",[s("strong",[t._v("参考文档：")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://blog.csdn.net/Sky_QiaoBa_Sum/article/details/109992744",target:"_blank",rel:"noopener noreferrer"}},[t._v("SpringCloud学习笔记之Hystrix"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/wangjunwei/p/12810953.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hystrix架构图介绍"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"hystrix两种命令模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix两种命令模式"}},[t._v("#")]),t._v(" Hystrix两种命令模式")]),t._v(" "),s("ul",[s("li",[t._v("HystrixCommand 和 HystrixObservableCommand")]),t._v(" "),s("li",[t._v("HystrixCommand 会以隔离的形式完成run方法调用")]),t._v(" "),s("li",[t._v("HystrixObservableCommand 使用当前线程进行调用")])]),t._v(" "),s("h2",{attrs:{id:"hystrix配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix配置"}},[t._v("#")]),t._v(" Hystrix配置")]),t._v(" "),s("h3",{attrs:{id:"groupkey"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#groupkey"}},[t._v("#")]),t._v(" GroupKey")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix中GroupKey是唯一必填项")]),t._v(" "),s("li",[t._v("GroupKey可以座位分组监控和报警的作用")]),t._v(" "),s("li",[t._v("groupKey将作为线程池的默认名称")])]),t._v(" "),s("h3",{attrs:{id:"commandkey"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#commandkey"}},[t._v("#")]),t._v(" CommandKey")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix可以不填写CommandKey")]),t._v(" "),s("li",[t._v("默认CommandKey会通过反射类名命名CommandKey")]),t._v(" "),s("li",[t._v("再Setting中加入andCommandKey进行命名")])]),t._v(" "),s("h2",{attrs:{id:"hystrix请求特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix请求特性"}},[t._v("#")]),t._v(" Hystrix请求特性")]),t._v(" "),s("h3",{attrs:{id:"hystrix请求缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix请求缓存"}},[t._v("#")]),t._v(" Hystrix请求缓存")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix支持将请求结果进行本地缓存")]),t._v(" "),s("li",[t._v("通过实现getCachekey方法来判断是否取出缓存")]),t._v(" "),s("li",[t._v("请求缓存要求请求必须在同一个上下文")]),t._v(" "),s("li",[t._v("可以通过RequestCacheEnable开启请求缓存")])]),t._v(" "),s("h3",{attrs:{id:"hystrix请求合并"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix请求合并"}},[t._v("#")]),t._v(" Hystrix请求合并")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix支持将多个请求合并成一次请求")]),t._v(" "),s("li",[t._v("Hystrix请求合并要求两次请求必须足够“近”（默认阈值500ms）")]),t._v(" "),s("li",[t._v("请求合并分为局部合并和全局合并")]),t._v(" "),s("li",[t._v("Collapser可以设置相关参数")])]),t._v(" "),s("h2",{attrs:{id:"hystrix隔离术"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix隔离术"}},[t._v("#")]),t._v(" Hystrix隔离术")]),t._v(" "),s("h3",{attrs:{id:"hystrix隔离之threadpoolkey"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix隔离之threadpoolkey"}},[t._v("#")]),t._v(" Hystrix隔离之ThreadPoolKey")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix可以不填写ThreadPoolKey")]),t._v(" "),s("li",[t._v("默认Hystrix会使用GroupKey命名线程池")]),t._v(" "),s("li",[t._v("在Setting中加入andThreadPoolKey进行命名")])]),t._v(" "),s("h3",{attrs:{id:"hystrix隔离介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix隔离介绍"}},[t._v("#")]),t._v(" Hystrix隔离介绍")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix提供了信号量和线程两种隔离手段")]),t._v(" "),s("li",[t._v("线程隔离会在单独的线程中执行业务逻辑")]),t._v(" "),s("li",[t._v("信号量隔离在调用线程上执行")]),t._v(" "),s("li",[t._v("官方推荐优先线程隔离")])]),t._v(" "),s("p",[s("strong",[t._v("Hystrix隔离示意图")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/01/Dh3vdI.png",alt:"Hystrix隔离示例图"}})]),t._v(" "),s("h3",{attrs:{id:"线程隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程隔离"}},[t._v("#")]),t._v(" 线程隔离")]),t._v(" "),s("ul",[s("li",[t._v("应用自身完全受保护，不会受其他依赖影响")]),t._v(" "),s("li",[t._v("有效减低接入新服务的风险")]),t._v(" "),s("li",[t._v("依赖服务如果出现问题，应用自身可以快速反应问题")]),t._v(" "),s("li",[t._v("可以通过实时刷新动态属性减少依赖问题影响")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/01/Dh88m9.png",alt:"线程隔离示意图1"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/01/Dh8T7n.png",alt:"线程隔离示意图2"}})]),t._v(" "),s("h3",{attrs:{id:"信号量隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#信号量隔离"}},[t._v("#")]),t._v(" 信号量隔离")]),t._v(" "),s("ul",[s("li",[t._v("信号量隔离是轻量级的隔离术")]),t._v(" "),s("li",[t._v("无网络开销的情况推荐使用信号量隔离")]),t._v(" "),s("li",[t._v("信号量是通过计数器与请求线程比对进行限流的")])]),t._v(" "),s("h2",{attrs:{id:"hystrix降级处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix降级处理"}},[t._v("#")]),t._v(" Hystrix降级处理")]),t._v(" "),s("h3",{attrs:{id:"hystrix降级介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix降级介绍"}},[t._v("#")]),t._v(" Hystrix降级介绍")]),t._v(" "),s("ul",[s("li",[t._v("降级是一种“无奈”的选择，就是所谓的备胎")]),t._v(" "),s("li",[t._v("Command降级需要实现fallback方法")]),t._v(" "),s("li",[t._v("ObserveCommand降级实现resumeWithFallback方法")])]),t._v(" "),s("h3",{attrs:{id:"降级触发原则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#降级触发原则"}},[t._v("#")]),t._v(" 降级触发原则")]),t._v(" "),s("ul",[s("li",[t._v("HystrixBadRequestException以外的异常")]),t._v(" "),s("li",[t._v("运行超时活熔断器处于开启状态")]),t._v(" "),s("li",[t._v("线程池或信号量已满")])]),t._v(" "),s("h3",{attrs:{id:"快速失败"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速失败"}},[t._v("#")]),t._v(" 快速失败")]),t._v(" "),s("ul",[s("li",[t._v("Hystrix提供了快速失败的机制")]),t._v(" "),s("li",[t._v("当不实现fallback方法时会将异常直接抛出")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/02/DI9ORx.png",alt:"image-20201202131355651"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/02/DI9Xz6.png",alt:"image-20201202131420641"}})]),t._v(" "),s("h2",{attrs:{id:"hystrix熔断机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix熔断机制"}},[t._v("#")]),t._v(" Hystrix熔断机制")]),t._v(" "),s("h3",{attrs:{id:"熔断器介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#熔断器介绍"}},[t._v("#")]),t._v(" 熔断器介绍")]),t._v(" "),s("ul",[s("li",[t._v("熔断器是一种开关，用来控制流量是否执行业务逻辑")]),t._v(" "),s("li",[t._v("熔断器核心指标：快照时间窗（一个时间段）")]),t._v(" "),s("li",[t._v("熔断器核心指标：请求总数阈值（快照时间窗内的请求总数）")]),t._v(" "),s("li",[t._v("熔断器核心指标：错误百分比阈值（快照时间窗内错误请求比例）")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/02/DI9xsO.png",alt:"image-20201202134641474"}})]),t._v(" "),s("p",[t._v("Hystrix在一个请求时间窗内，请求总数达到阈值，并且错误百分比达到阈值才会触发熔断")]),t._v(" "),s("h3",{attrs:{id:"熔断器状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#熔断器状态"}},[t._v("#")]),t._v(" 熔断器状态")]),t._v(" "),s("ul",[s("li",[t._v("熔断器开启：所有请求都会进入fallback方法")]),t._v(" "),s("li",[t._v("熔断器半开启：间歇性让请求触发run方法")]),t._v(" "),s("li",[t._v("熔断器关闭：正常处理业务请求")]),t._v(" "),s("li",[t._v("默认情况下熔断器开启5s后进入半开启状态")])]),t._v(" "),s("p",[t._v("半开启状态下会间歇性放行一个请求去执行业务逻辑，去检测业务是否恢复，如果恢复了再关闭熔断器")]),t._v(" "),s("h3",{attrs:{id:"hystrix监控平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix监控平台"}},[t._v("#")]),t._v(" Hystrix监控平台")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.ax1x.com/2020/12/02/DI9zLD.png",alt:"image-20201202154934189"}})]),t._v(" "),s("h2",{attrs:{id:"hystrix线程池设计官方建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hystrix线程池设计官方建议"}},[t._v("#")]),t._v(" Hystrix线程池设计官方建议")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/14873987-65c68627c6382197.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"Hystrix线程池"}})]),t._v(" "),s("h2",{attrs:{id:"附录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[t._v("#")]),t._v(" 附录")]),t._v(" "),s("h3",{attrs:{id:"配置参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置参数"}},[t._v("#")]),t._v(" 配置参数")]),t._v(" "),s("p",[s("strong",[t._v("Command基础配置")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置")]),t._v(" "),s("th",[t._v("配置描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("execution.isolation.strategy")]),t._v(" "),s("td",[t._v("隔离类型：THREAD-线程隔离，SEMAPHORE-信号量隔离")])]),t._v(" "),s("tr",[s("td",[t._v("execution.timeout.enabled")]),t._v(" "),s("td",[t._v("超时检查是否开启")])]),t._v(" "),s("tr",[s("td",[t._v("fallback.enabled")]),t._v(" "),s("td",[t._v("是否开启降级处理")])])])]),t._v(" "),s("p",[s("strong",[t._v("请求上下文配置")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置")]),t._v(" "),s("th",[t._v("配置描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("requestCache.enabled")]),t._v(" "),s("td",[t._v("是否开启请求缓存，默认为true")])]),t._v(" "),s("tr",[s("td",[t._v("requestLog.enabled")]),t._v(" "),s("td",[t._v("是否开启请求日志，默认为true")])]),t._v(" "),s("tr",[s("td",[t._v("maxRequestsInBatch")]),t._v(" "),s("td",[t._v("设置批处理中允许的最大请求数")])]),t._v(" "),s("tr",[s("td",[t._v("timerDelayInMilliseconds")]),t._v(" "),s("td",[t._v("设置批处理创建到执行之间的毫秒数")])])])]),t._v(" "),s("p",[s("strong",[t._v("线程池相关配置")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置")]),t._v(" "),s("th",[t._v("配置描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("coreSize")]),t._v(" "),s("td",[t._v("配置线程池大小，默认为10")])]),t._v(" "),s("tr",[s("td",[t._v("keepAliveTimeMinutes")]),t._v(" "),s("td",[t._v("配置核心线程数空闲时keepAlived时长，默认1分钟")])]),t._v(" "),s("tr",[s("td",[t._v("maxQueueSize")]),t._v(" "),s("td",[t._v("配置线程池任务队列大小，默认为-1")])]),t._v(" "),s("tr",[s("td",[t._v("maximumSize")]),t._v(" "),s("td",[t._v("线程池中线程的最大数量，默认值是 10")])]),t._v(" "),s("tr",[s("td",[t._v("queueSizeRejectionThreshold")]),t._v(" "),s("td",[t._v("任务队列的请求上限，默认值是10")])]),t._v(" "),s("tr",[s("td",[t._v("allowMaximumSizeToDivergeFromCoreSize")]),t._v(" "),s("td",[t._v("是否开启最大线程数")])]),t._v(" "),s("tr",[s("td",[t._v("execution.isolation.thread.timeoutInMilliseconds")]),t._v(" "),s("td",[t._v("设置超时时间")])]),t._v(" "),s("tr",[s("td",[t._v("execution.isolation.thread.interruptOnTimeout")]),t._v(" "),s("td",[t._v("请求超时是否中断任务")])]),t._v(" "),s("tr",[s("td",[t._v("execution.isolation.thread.interruptOnCancel")]),t._v(" "),s("td",[t._v("请求取消是否终端任务")])])])]),t._v(" "),s("p",[s("strong",[t._v("信号量隔离配置")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置")]),t._v(" "),s("th",[t._v("配置描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("execution.isolation.semaphore.maxConcurrentRequests")]),t._v(" "),s("td",[t._v("任务执行信号量最大数")])]),t._v(" "),s("tr",[s("td",[t._v("fallback.isolation.semaphore.maxConcurrentRequests")]),t._v(" "),s("td",[t._v("失败任务执行信号量最大数")])])])]),t._v(" "),s("p",[s("strong",[t._v("熔断机制相关配置")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置")]),t._v(" "),s("th",[t._v("配置描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("circuitBreaker.enabled")]),t._v(" "),s("td",[t._v("是否开启熔断器")])]),t._v(" "),s("tr",[s("td",[t._v("circuitBreaker.requestVolumeThreshold")]),t._v(" "),s("td",[t._v("启用熔断器功能窗口时间内的最小请求数")])]),t._v(" "),s("tr",[s("td",[t._v("circuitBreaker.sleepWindowInMilliseconds")]),t._v(" "),s("td",[t._v("半熔断开启时间")])]),t._v(" "),s("tr",[s("td",[t._v("circuitBreaker.errorThresholdPercentage")]),t._v(" "),s("td",[t._v("开启熔断的失败率阈值")])]),t._v(" "),s("tr",[s("td",[t._v("circuitBreaker.forceOpen")]),t._v(" "),s("td",[t._v("强制开启熔断器")])]),t._v(" "),s("tr",[s("td",[t._v("circuitBreaker.forceClosed")]),t._v(" "),s("td",[t._v("强制关闭熔断器")])])])]),t._v(" "),s("p",[s("strong",[t._v("metrics相关配置")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置")]),t._v(" "),s("th",[t._v("配置描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("metrics.rollingStats.timeInMilliseconds")]),t._v(" "),s("td",[t._v("此配置项指定了窗口的大小，单位是 ms，默认值是 1000")])]),t._v(" "),s("tr",[s("td",[t._v("metrics.rollingStats.numBuckets")]),t._v(" "),s("td",[t._v("生成统计数据流时滑动窗口应该拆分的桶数")])]),t._v(" "),s("tr",[s("td",[t._v("metrics.rollingPercentile.enabled")]),t._v(" "),s("td",[t._v("是否统计方法响应时间百分比，默认为 true")])]),t._v(" "),s("tr",[s("td",[t._v("metrics.rollingPercentile.timeInMilliseconds")]),t._v(" "),s("td",[t._v("统计响应时间百分比时的窗口大小")])]),t._v(" "),s("tr",[s("td",[t._v("metrics.rollingPercentile.numBuckets")]),t._v(" "),s("td",[t._v("统计响应时间百分比时滑动窗口要划分的桶用，默认为6")])]),t._v(" "),s("tr",[s("td",[t._v("metrics.rollingPercentile.bucketSize")]),t._v(" "),s("td",[t._v("统计响应时间百分比时，每个滑动窗口的桶内要保留的请求数")])]),t._v(" "),s("tr",[s("td",[t._v("metrics.healthSnapshot.intervalInMilliseconds")]),t._v(" "),s("td",[t._v("它指定了健康数据统计器中每个桶的大小，默认是 500ms")])])])]),t._v(" "),s("h3",{attrs:{id:"参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://my.oschina.net/7001/blog/1619842",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hystrix原理与实战"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.qdcto.com/archives/440",target:"_blank",rel:"noopener noreferrer"}},[t._v("深入学习Hystrix"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.jianshu.com/p/fe86c36031a7",target:"_blank",rel:"noopener noreferrer"}},[t._v("微服务实战SpringCloud之Hystrix"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);