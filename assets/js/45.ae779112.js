(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{370:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_4-1-nginx常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-nginx常见问题"}},[s._v("#")]),s._v(" 4.1 Nginx常见问题")]),s._v(" "),a("h3",{attrs:{id:"_4-1-1-相同server-name多个虚拟主机优先级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-相同server-name多个虚拟主机优先级"}},[s._v("#")]),s._v(" 4.1.1 相同server_name多个虚拟主机优先级")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://z3.ax1x.com/2021/08/03/fiGXo8.png",alt:"image-20210803162722397"}})]),s._v(" "),a("p",[s._v("当多个同名 "),a("code",[s._v("server_name")]),s._v("，优先走先读取到的配置")]),s._v(" "),a("ul",[a("li",[s._v("写在同一配置文件里的，走写在上面的")]),s._v(" "),a("li",[s._v("写在不同配置文件里的，走文件名排序靠前的")])]),s._v(" "),a("h3",{attrs:{id:"_4-1-2-location匹配优先级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-location匹配优先级"}},[s._v("#")]),s._v(" 4.1.2 location匹配优先级")]),s._v(" "),a("ol",[a("li",[a("strong",[a("code",[s._v("=")])]),s._v("：进行普通字符精确匹配，也就是完全匹配")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("^~")])]),s._v("：表示普通字符匹配，使用前缀匹配")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("~ \\~*")])]),s._v("：表示执行一个正则匹配")])]),s._v(" "),a("p",[s._v("请求来了，从上到下，如果匹配到前两个，则不再继续匹配，直接走相应的location；如果匹配到正则匹配，还将继续向下匹配，看有没有更匹配的location。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 精确匹配")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /code1/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^(.*)$ /code1/index.html break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前缀匹配")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~ /code")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^(.*)$ /code2/index.html break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正则匹配")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ /code.*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^(.*)$ /code3/index.html break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_4-1-3-try-files使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-3-try-files使用"}},[s._v("#")]),s._v(" 4.1.3 try_files使用")]),s._v(" "),a("p",[a("code",[s._v("try_files")]),s._v(" 用于按顺序检查文件是否存在，存在就直接返回")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.php")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_4-1-4-nginx的alias和root区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-4-nginx的alias和root区别"}},[s._v("#")]),s._v(" 4.1.4 Nginx的alias和root区别")]),s._v(" "),a("p",[a("code",[s._v("root")]),s._v(" 和 "),a("code",[s._v("alias")]),s._v(" 都用于讲请求指向本地文件，不过指向方式不同")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /request_path/image/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /local_path/image/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /request_path/image/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /local_path/image/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("对于上述两个配置，如果请求路径为 "),a("code",[s._v("http://localhost/request_path/image/cat.png")]),s._v("，root和alias将请求不同的文件：")]),s._v(" "),a("ul",[a("li",[s._v("root: /local_path/image/request_path/image/cat.png")]),s._v(" "),a("li",[s._v("alias: /local_path/image/cat.png")])]),s._v(" "),a("h3",{attrs:{id:"_4-1-5-传递用户真实ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-5-传递用户真实ip"}},[s._v("#")]),s._v(" 4.1.5 传递用户真实IP")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://z3.ax1x.com/2021/08/03/fiaMaq.png",alt:"image-20210803165207159"}})]),s._v(" "),a("p",[s._v("当用户请求经过多级代理到达后端服务器的时候，通过 "),a("code",[s._v("x_forwarded_for")]),s._v(" 获取的ip往往不准确，且容易被篡改。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://z3.ax1x.com/2021/08/03/fiaIW8.png",alt:"image-20210803165404231"}})]),s._v(" "),a("p",[s._v("可以再一级代理处将用户ip添加到指定请求头 "),a("code",[s._v("x_real_ip")]),s._v(" 中，后续的服务通过该请求头获取用户ip。")])])}),[],!1,null,null,null);a.default=e.exports}}]);