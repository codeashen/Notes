(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{367:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-1-环境准备和概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-环境准备和概述"}},[s._v("#")]),s._v(" 1.1 环境准备和概述")]),s._v(" "),t("h3",{attrs:{id:"_1-1-1-环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-环境准备"}},[s._v("#")]),s._v(" 1.1.1 环境准备")]),s._v(" "),t("p",[s._v("使用CentOS 7，执行以下命令进行初始化：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认网络")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" www.baidu.com\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认yum可用")]),s._v("\nyum list"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" gcc\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认关闭iptables规则")]),s._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认停用selinux")]),s._v("\ngetenforce\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装gcc相关")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc gcc-c++ autoconf pcre pcre-devel "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" automake\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装相关工具")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http-tools "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建相关路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" app backup download logs work\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h3",{attrs:{id:"_1-1-2-nginx概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-nginx概述"}},[s._v("#")]),s._v(" 1.1.2 Nginx概述")]),s._v(" "),t("p",[s._v("中间件示意图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTb8TU.png",alt:"image-20201228173646625"}})]),s._v(" "),t("p",[s._v("Nginx是一个开源且高性能、可靠的HTTP中间件、代理服务。")]),s._v(" "),t("h2",{attrs:{id:"_1-2-nginx特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-nginx特性"}},[s._v("#")]),s._v(" 1.2 Nginx特性")]),s._v(" "),t("ol",[t("li",[s._v("IO多路复用epoll")]),s._v(" "),t("li",[s._v("轻量级")]),s._v(" "),t("li",[s._v("CPU亲和")]),s._v(" "),t("li",[s._v("sendfile")])]),s._v(" "),t("h3",{attrs:{id:"_1-2-1-特性一-io多路复用epoll"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-特性一-io多路复用epoll"}},[s._v("#")]),s._v(" 1.2.1 特性一 IO多路复用epoll")]),s._v(" "),t("p",[s._v("什么是IO复用？")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTbJkF.png",alt:"image-20201228174641747"}})]),s._v(" "),t("p",[s._v("什么是IO多路复用？")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTbW6I.jpg",alt:"img"}})]),s._v(" "),t("p",[s._v("多个描述符的I/O操作都能在一个线程内并发交替地顺序完成，这就叫I/O多路复用，这里的“复用”指的是复用同一个线程。")]),s._v(" "),t("p",[s._v("什么是epoll？")]),s._v(" "),t("p",[s._v("IO多路复用的实现方式select、poll、epoll")]),s._v(" "),t("p",[s._v("什么是select？")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTbYY4.png",alt:"image-20201228175643929"}})]),s._v(" "),t("p",[s._v("select缺点：")]),s._v(" "),t("ol",[t("li",[s._v("能够监视文件描述符的数量存在最大限制")]),s._v(" "),t("li",[s._v("线性扫描效率低下")])]),s._v(" "),t("p",[s._v("epoll模型有点：")]),s._v(" "),t("ol",[t("li",[s._v("每当FD就绪，采用系统的回调函数之间将fd放入，效率更高。")]),s._v(" "),t("li",[s._v("最大连接无限制")])]),s._v(" "),t("h3",{attrs:{id:"_1-2-2-特性二-轻量级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-特性二-轻量级"}},[s._v("#")]),s._v(" 1.2.2 特性二 轻量级")]),s._v(" "),t("p",[s._v("功能模块少，代码模块化")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTbykD.jpg",alt:"这里写图片描述"}})]),s._v(" "),t("h3",{attrs:{id:"_1-2-3-特性三-cpu亲和"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-特性三-cpu亲和"}},[s._v("#")]),s._v(" 1.2.3 特性三 CPU亲和")]),s._v(" "),t("p",[s._v("为什么需要CPU亲和")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTbalR.png",alt:"image-20201228180918009"}})]),s._v(" "),t("p",[s._v("什么是CPU亲和？")]),s._v(" "),t("p",[s._v("是一种把CPU核心和Nginx工作进程绑定方式，把每个worker进程固定在一个cpu上执行，减少切换cpu的cache miss，获得更好的性能。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-4-特性四-sendfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-特性四-sendfile"}},[s._v("#")]),s._v(" 1.2.4 特性四 sendfile")]),s._v(" "),t("p",[s._v("Nginx处理静态文件的效率非常好，就是利用了sendfile的特性")]),s._v(" "),t("p",[s._v("原来的Http Server的处理方式：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTbd61.png",alt:"image-20201228181734135"}})]),s._v(" "),t("p",[s._v("sendfile模式：把文件的传输直接从内核空间传输到socket，0拷贝")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/28/rTbwOx.png",alt:"image-20201228182248898"}})]),s._v(" "),t("h2",{attrs:{id:"_1-3-快速安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-快速安装"}},[s._v("#")]),s._v(" 1.3 快速安装")]),s._v(" "),t("p",[s._v("设置官网yum源")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/yum.repos.d/nginx.repo/nginx.repo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将官网上的yum源头配置复制进去")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nginx-stable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx stable repo\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://nginx.org/packages/centos/7/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("/\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgkey")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://nginx.org/keys/nginx_signing.key\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("module_hotfixes")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("执行安装命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_1-4-nginx安装目录和配置语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-nginx安装目录和配置语法"}},[s._v("#")]),s._v(" 1.4 Nginx安装目录和配置语法")]),s._v(" "),t("h3",{attrs:{id:"_1-4-1-安装目录介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-安装目录介绍"}},[s._v("#")]),s._v(" 1.4.1 安装目录介绍")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("路径")]),s._v(" "),t("th",[s._v("类型")]),s._v(" "),t("th",[s._v("作用")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("/etc/logrotate.d/nginx")]),s._v(" "),t("td",[s._v("配置文件")]),s._v(" "),t("td",[s._v("Nginx日志轮转，用于logrotate服务的日志切割")])]),s._v(" "),t("tr",[t("td",[s._v("/etc/nginx "),t("br"),s._v("/etc/nginx/nginx.conf "),t("br"),s._v("/etcynginx/conf.d "),t("br"),s._v("/etc/nginx/conf.d/default.conf")]),s._v(" "),t("td",[s._v("目录、配置文件")]),s._v(" "),t("td",[s._v("Nginx主配置文件")])]),s._v(" "),t("tr",[t("td",[s._v("/etc/nginx/fastcgi_params "),t("br"),s._v("/etc/nginx/uwsgi_params "),t("br"),s._v("/etc/nginx/scgi_params")]),s._v(" "),t("td",[s._v("配置文件")]),s._v(" "),t("td",[s._v("cgi配置相关、fastcgi配置相关")])]),s._v(" "),t("tr",[t("td",[s._v("/etc/nginx/koi-utf "),t("br"),s._v("/etc/nginx/koi-win "),t("br"),s._v("/etc/nginx/win-utf")]),s._v(" "),t("td",[s._v("配置文件")]),s._v(" "),t("td",[s._v("编码转换映射转化文件")])]),s._v(" "),t("tr",[t("td",[s._v("/etc/nginx/mime.types")]),s._v(" "),t("td",[s._v("配置文件")]),s._v(" "),t("td",[s._v("设置http协议的Content-Type与扩展名对应关系")])]),s._v(" "),t("tr",[t("td",[s._v("/usr/lib/systemd/system/nginx-debug.service "),t("br"),s._v("/usr/lib/systemd/system/nginx.service "),t("br"),s._v("/etc/sysconfig/nginx "),t("br"),s._v("/etc/sysconfig/nginx-debug")]),s._v(" "),t("td",[s._v("配置文件")]),s._v(" "),t("td",[s._v("用于配置出系统守护进程管理器管理方式")])]),s._v(" "),t("tr",[t("td",[s._v("/usr/lib64/nginx/modules "),t("br"),s._v("/etc/nginx/modules")]),s._v(" "),t("td",[s._v("目录")]),s._v(" "),t("td",[s._v("Nginx模块目录")])]),s._v(" "),t("tr",[t("td",[s._v("/usr/sbin/nginx "),t("br"),s._v("/usr/sbin/ngink-debug")]),s._v(" "),t("td",[s._v("命令")]),s._v(" "),t("td",[s._v("Nginx服务的启动管理的终端命令")])]),s._v(" "),t("tr",[t("td",[s._v("/usr/share/doc/nginx-1.12.0 "),t("br"),s._v("/usr/share/doc/nginx-1.12.0/COPYRIGHT "),t("br"),s._v("/usr/share/man/man8/nginx.8.gz")]),s._v(" "),t("td",[s._v("文件、目录")]),s._v(" "),t("td",[s._v("Nginx的手册和帮助文档")])]),s._v(" "),t("tr",[t("td",[s._v("/var/cache/nginx")]),s._v(" "),t("td",[s._v("目录")]),s._v(" "),t("td",[s._v("Nginx的缓存目录")])]),s._v(" "),t("tr",[t("td",[s._v("/var/log/nginx")]),s._v(" "),t("td",[s._v("目录")]),s._v(" "),t("td",[s._v("Nginx的日志目录")])])])]),s._v(" "),t("h3",{attrs:{id:"_1-4-2-编译参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-2-编译参数"}},[s._v("#")]),s._v(" 1.4.2 编译参数")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("nginx - V")]),s._v("可以查看nginx的安装编译参数：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("--prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC' --with-ld-opt='-Wl,-z,relro -Wl,-z,now -pie'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",[s._v("编译参数")]),s._v(" "),t("th",[s._v("作用")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("--prefix=/etc/nginx "),t("br"),s._v("--sbin-path=/usr/sbin/nginx "),t("br"),s._v("--modules-path=/usr/lib64/nginx/modules "),t("br"),s._v("--conf-path=/etc/nginx/nginx.conf "),t("br"),s._v("--error-log-path=/var/log/nginx/error.log "),t("br"),s._v("--http-log-path=/var/log/nginx/access.log "),t("br"),s._v("--pid-path=/var/run/nginx.pid "),t("br"),s._v("--lock-path=/var/run/nginx.lock")]),s._v(" "),t("td",[s._v("安装目的目录或路径")])]),s._v(" "),t("tr",[t("td",[s._v("--http-client-body-temp-path=/var/cache/nginx/client_temp"),t("br"),s._v("--http-proxy-temp-path=/var/cache/nginx/proxy_temp "),t("br"),s._v("--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp "),t("br"),s._v("--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp "),t("br"),s._v("--http-scgi-temp-path=/var/cache/nginx/scgi_temp")]),s._v(" "),t("td",[s._v("执行对应模块时，Nginx所保留的临时性文件")])]),s._v(" "),t("tr",[t("td",[s._v("--user=nginx "),t("br"),s._v("--group=nginx")]),s._v(" "),t("td",[s._v("设定Nginx进程启动的用户和组用户")])]),s._v(" "),t("tr",[t("td",[s._v("--with-cc-opt=parameters")]),s._v(" "),t("td",[s._v("设置额外的参数将被添加到CFLAGS变量")])]),s._v(" "),t("tr",[t("td",[s._v("-with-ld-opt=parameters")]),s._v(" "),t("td",[s._v("设置附加的参数，链接系统库")])])])]),s._v(" "),t("h3",{attrs:{id:"_1-4-3-配置文件结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-3-配置文件结构"}},[s._v("#")]),s._v(" 1.4.3 配置文件结构")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[s._v("...               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局块")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#events块")]),s._v("\n   ...\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http块")]),s._v("\n    ...           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http全局块")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server块")]),s._v("\n        ...       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server全局块")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" [PATTERN]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location块")]),s._v("\n            ...\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" [PATTERN]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            ...\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      ...\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    ...     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http全局块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("ol",[t("li",[s._v("全局块：配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。")]),s._v(" "),t("li",[s._v("events块：配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。")]),s._v(" "),t("li",[s._v("http块：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。")]),s._v(" "),t("li",[s._v("server块：配置虚拟主机的相关参数，一个http中可以有多个server。")]),s._v(" "),t("li",[s._v("location块：配置请求的路由，以及各种页面的处理情况。")])]),s._v(" "),t("p",[s._v("配置文件示例：")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("########### 每个指令必须有分号结束。#################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user administrator administrators; #配置用户或者组，默认为nobody nobody。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#worker_processes 2;                #允许生成的进程数，默认为1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid /nginx/pid/nginx.pid;          #指定nginx进程运行文件存放地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v(" log/error.log debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("accept_mutex")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置网路连接序列化，防止惊群现象发生，默认为on")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("multi_accept")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置一个进程是否同时接受多个网络连接，默认为off")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#use epoll;                     #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最大连接数，默认为512")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("  mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件扩展名与文件类型映射表")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v(" application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认文件类型，默认为text/plain")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log off;                        #取消服务日志    ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_format")]),s._v(" myFormat "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr–")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$time_local]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$body_bytes_sent")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_referer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_x_forwarded_for")]),s._v("'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#自定义格式")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" log/access.log myFormat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#combined为日志格式的默认值")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile_max_chunk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接超时时间，默认为75s，可以在http，server，location块。")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" mysvr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("   \n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:7878")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.10.121:3333 backup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#热备")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" https://www.baidu.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误页")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_requests")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#单连接请求上限次数。")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4545")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监听端口")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" 127.0.0.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监听地址       ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v("  ~*^.+$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#root path;                      #根目录")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#index vv.txt;                   #设置默认页")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://mysvr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#请求转向mysvr 定义的服务器列表")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 127.0.0.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拒绝的ip")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 172.18.5.54")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许的ip           ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("h3",{attrs:{id:"_1-4-4-基础配置语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-4-基础配置语法"}},[s._v("#")]),s._v(" 1.4.4 基础配置语法")]),s._v(" "),t("p",[s._v("Nginx默认配置语法")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("配置")]),s._v(" "),t("th",[s._v("含义")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("user")]),s._v(" "),t("td",[s._v("设置nginx服务的系统使用用户")])]),s._v(" "),t("tr",[t("td",[s._v("worker_processes")]),s._v(" "),t("td",[s._v("工作进程数")])]),s._v(" "),t("tr",[t("td",[s._v("error_log")]),s._v(" "),t("td",[s._v("nginx的错误日志")])]),s._v(" "),t("tr",[t("td",[s._v("pid")]),s._v(" "),t("td",[s._v("nginx服务启动时候pid")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rHAKHO.png",alt:"image-20201229103656491"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rHANKP.png",alt:"image-20201229103931502"}})]),s._v(" "),t("p",[s._v("其他配置介绍")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 涵盖了所有的content-type，并设置默认的content-type")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       /etc/nginx/mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志格式，命名为main")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_format")]),s._v("  main  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$time_local]")]),s._v(' "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request")]),s._v("\" '")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$body_bytes_sent")]),s._v(' "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_referer")]),s._v("\" '")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\""),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v('" "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_x_forwarded_for")]),s._v("\"'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问日志，使用main定义的日志格式")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  /var/log/nginx/access.log  main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启sendfile模式")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接超时时间")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含的子配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" /etc/nginx/conf.d/*.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("子配置文件初始只有一个 /etc/nginx/conf.d/default.conf")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset koi8-r;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  /var/log/nginx/host.access.log  main;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /usr/share/nginx/html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_page  404              /404.html;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redirect server error pages to the static page /50x.html")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /usr/share/nginx/html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy the PHP scripts to Apache listening on 127.0.0.1:80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    proxy_pass   http://127.0.0.1;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    root           html;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_pass   127.0.0.1:9000;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_index  index.php;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    include        fastcgi_params;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deny access to .htaccess files, if Apache's document root")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# concurs with nginx's one")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ /\\.ht {")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    deny  all;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br")])]),t("p",[s._v("修改配置后重启nginx")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-9")]),s._v(" nginx\nsystemctl restart nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\nsystemctl reload nginx.service\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"_1-5-nginx虚拟主机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-nginx虚拟主机"}},[s._v("#")]),s._v(" 1.5 Nginx虚拟主机")]),s._v(" "),t("h3",{attrs:{id:"_1-5-1-nginx虚拟主机及实现方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-nginx虚拟主机及实现方式"}},[s._v("#")]),s._v(" 1.5.1 Nginx虚拟主机及实现方式")]),s._v(" "),t("p",[s._v("多套业务服务如何配置？")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rHX8Ds.png",alt:""}})]),s._v(" "),t("p",[s._v("这种配置方式是非常低效的，一般企业也不会这么做。")]),s._v(" "),t("p",[t("strong",[s._v("虚拟主机配置")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rHjARU.png",alt:""}})]),s._v(" "),t("p",[s._v("一个Nginx服务器中配置多个虚拟主机，一个Nginx代理服务器代理多个服务是企业里面非常常见的模式；")]),s._v(" "),t("p",[s._v("虚拟主机配置：在同一个Nginx上运行多套单独服务，这些服务是相互独立的；")]),s._v(" "),t("p",[s._v("配置方式有以下三种：")]),s._v(" "),t("ol",[t("li",[s._v("基于主机多IP方式")]),s._v(" "),t("li",[s._v("基于多port方式")]),s._v(" "),t("li",[s._v("基于多host名称方式（多域名方式）")])]),s._v(" "),t("p",[t("strong",[s._v("单网卡多IP方式")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rbiEzq.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("多网卡多IP方式")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rbPzsf.png",alt:""}})]),s._v(" "),t("p",[s._v("查看网卡信息")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@titan conf.d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig")]),s._v("\neth0: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.206  netmask "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0  broadcast "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.255\n        ether fa:16:3e:38:f8:97  txqueuelen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2347541")]),s._v("  bytes "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("557726609")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("531.8")]),s._v(" MiB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2069558")]),s._v("  bytes "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("343561987")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("327.6")]),s._v(" MiB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nlo: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,LOOPBACK,RUNNING"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n        inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1  netmask "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.0")]),s._v(".0.0\n        loop  txqueuelen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Local Loopback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4965296")]),s._v("  bytes "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("266083612")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("253.7")]),s._v(" MiB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4965296")]),s._v("  bytes "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("266083612")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("253.7")]),s._v(" MiB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@titan conf.d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip a")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": eth0: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc pfifo_fast state UP group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether fa:16:3e:38:f8:97 brd ff:ff:ff:ff:ff:ff\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.206/24 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("ul",[t("li",[s._v("lo网卡是回环网卡 虚拟网卡 它的IP地址是127.0.0.1，利用这个接口可以实现系统内部发送和接收数据")]),s._v(" "),t("li",[s._v("eth0网卡是物理网卡")])]),s._v(" "),t("h3",{attrs:{id:"_1-5-2-nginx虚拟主机单网卡多ip配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-nginx虚拟主机单网卡多ip配置"}},[s._v("#")]),s._v(" 1.5.2 Nginx虚拟主机单网卡多IP配置")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rHjtLd.png",alt:""}})]),s._v(" "),t("ol",[t("li",[t("p",[s._v("在网卡eth0上添加虚拟IP")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加虚拟ip之前，先验证下局域网IP是否存在，ping不通就行，证明不存在，可以添加")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.207\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.208\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加虚拟ip1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.207/20 dev eth0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加虚拟ip2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.208/20 dev eth0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证是否添加上了")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" a\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("Nginx虚拟主机单网卡多IP配置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制一份默认配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/nginx/conf.d\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" default.conf server1.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑server1.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" server1.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下为配置内容")]),s._v("\nserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听ip")]),s._v("\n    server_name  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.206"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向不同的文件")]),s._v("\n    location / "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root   /usr/share/nginx/html/muti_ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        index  server1.html server1.htm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再来两份配置，并编辑内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" server1.conf server2.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" server1.conf server3.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重启nginx进程服务")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /etc/nginx/nginx.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("验证单网卡多IP配置是否生效")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在配置的路径下创建server1.html、server2.html、server3.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/nginx/html\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" muti_ip\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" index.html muti_ip/server1.html\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制三份做不同的修改，方便辨别")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证效果")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.206\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.207\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.208\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_1-5-3-nginx虚拟主机单网卡多端口配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-3-nginx虚拟主机单网卡多端口配置"}},[s._v("#")]),s._v(" 1.5.3 Nginx虚拟主机单网卡多端口配置")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rbFXKP.png",alt:""}})]),s._v(" "),t("p",[s._v("配置方式和单网卡多ip类似，只需要将上一节的三个server.conf指向统一ip，但是监听不同的端口就好了")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/nginx/conf.d/server1.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 做以下修改")]),s._v("\nlisten               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个配置不同")]),s._v("\nserver_name   localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个配置相同")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("重启nginx测试即可")]),s._v(" "),t("h3",{attrs:{id:"_1-5-4-nginx虚拟主机多host域名配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-4-nginx虚拟主机多host域名配置"}},[s._v("#")]),s._v(" 1.5.4 Nginx虚拟主机多host域名配置")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/29/rbdodK.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改hosts文件")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/hosts\n \n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加以下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 lucifer1.com\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 lucifer2.com\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 lucifer3.com\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改上述三个 server.conf，都监听80端口，server_name分别为上一步配置的三个域名")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启nginx测试")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h2",{attrs:{id:"_1-6-nginx日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-nginx日志"}},[s._v("#")]),s._v(" 1.6 Nginx日志")]),s._v(" "),t("h3",{attrs:{id:"_1-6-1-nginx日志配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-1-nginx日志配置"}},[s._v("#")]),s._v(" 1.6.1 Nginx日志配置")]),s._v(" "),t("p",[s._v("nginx日志类型包含 error.log 和 access_log")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("  nginx")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误日志路径，以及记录的日志等级")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v("  /var/log/nginx/error.log warn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),s._v("        /var/run/nginx.pid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       /etc/nginx/mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义日志格式，取名为main")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_format")]),s._v("  main  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$time_local]")]),s._v(' "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request")]),s._v("\" '")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$body_bytes_sent")]),s._v(' "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_referer")]),s._v("\" '")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\""),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v('" "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_x_forwarded_for")]),s._v("\"'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置访问日志路径，使用main定义的格式")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  /var/log/nginx/access.log  main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    ......\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" /etc/nginx/conf.d/*.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h3",{attrs:{id:"_1-6-2-nginx变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-2-nginx变量"}},[s._v("#")]),s._v(" 1.6.2 Nginx变量")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("HTTP请求变量")]),s._v("：arg_PARAMETER、http_HEADER、sent_http_HEADER")]),s._v(" "),t("li",[t("strong",[s._v("内置变量")]),s._v("：Nginx内置的")]),s._v(" "),t("li",[t("strong",[s._v("自定义变量")]),s._v("：自己定义")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测nginx配置的正确性")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /etc/nginx/nginx.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /etc/nginx/nginx.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("Nginx默认log_format参数介绍：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数")]),s._v(" "),t("th",[s._v("含义")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("$remote_addr")]),s._v(" "),t("td",[s._v("客户端请求地址")])]),s._v(" "),t("tr",[t("td",[s._v("$remote_user")]),s._v(" "),t("td",[s._v("客户端请求验证的用户名，没有就是空")])]),s._v(" "),t("tr",[t("td",[s._v("$time_local")]),s._v(" "),t("td",[s._v("本地时间")])]),s._v(" "),t("tr",[t("td",[s._v("$request")]),s._v(" "),t("td",[s._v("HTTP请求完整的原始请求行")])]),s._v(" "),t("tr",[t("td",[s._v("$status")]),s._v(" "),t("td",[s._v("服务端响应的状态码")])]),s._v(" "),t("tr",[t("td",[s._v("$body_bytes_sent")]),s._v(" "),t("td",[s._v("服务端返回给客户端字节大小")])]),s._v(" "),t("tr",[t("td",[s._v("$http_referer")]),s._v(" "),t("td",[s._v("链接来源")])]),s._v(" "),t("tr",[t("td",[s._v("$http_user_agent")]),s._v(" "),t("td",[s._v("HTTP请求头里的 User_Agent，客户端类型")])]),s._v(" "),t("tr",[t("td",[s._v("$http_x_forwarded_for")]),s._v(" "),t("td",[s._v("客户端请求的真实IP，如果代理存在，即有值，否则无值")])])])]),s._v(" "),t("p",[s._v("配置参考：http://nginx.org/en/docs/syslog.html")]),s._v(" "),t("h2",{attrs:{id:"_1-7-nginx模块讲解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-nginx模块讲解"}},[s._v("#")]),s._v(" 1.7 Nginx模块讲解")]),s._v(" "),t("p",[s._v("包含：Nginx官方模块、第三方模块")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("nginx -V")]),s._v("命令可以看到安装编译参数里以"),t("code",[s._v("--with")]),s._v("开头的是nginx开启的模块和粘连的模块")]),s._v(" "),t("h3",{attrs:{id:"_1-7-1-http-stub-status-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-1-http-stub-status-module"}},[s._v("#")]),s._v(" 1.7.1 http_stub_status_module")]),s._v(" "),t("p",[s._v("作用：获取Nginx客户端的状态")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("stub_status")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("server, location")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("配置示例：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("location = /my_nginx_status {\n    stub_status;\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("访问 "),t("code",[s._v("http: //{ip}/my_nginx_status")]),s._v("查看nginx状态")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost/my_nginx_status\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下为响应内容")]),s._v("\nActive connections: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#活跃连接数")]),s._v("\nserver accepts handled requests\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("                                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#已接受的客户端连接数  已处理的连接数  客户端连接数")]),s._v("\nReading: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Writing: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Waiting: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#读取请求头的当前连接数  将响应写回客户端的当前连接数  等待请求的当前空闲客户端连接数")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_1-7-2-http-random-index-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-2-http-random-index-module"}},[s._v("#")]),s._v(" 1.7.2 http_random_index_module")]),s._v(" "),t("p",[s._v("作用：目录中随机选择一个主页")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("random_index on|off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("andom_index on|off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("location")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("配置示例：")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /usr/share/nginx/html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index_1.html index_2.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("random_index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#随机从上面指定的index中选择一个返回")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_1-7-3-http-sub-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-3-http-sub-module"}},[s._v("#")]),s._v(" 1.7.3 http_sub_module")]),s._v(" "),t("p",[s._v("作用：HTTP内容替换")]),s._v(" "),t("p",[s._v("这个模块的配置需要几个配置配合使用")]),s._v(" "),t("p",[t("strong",[s._v("(1) sub_filter")])]),s._v(" "),t("p",[s._v("配置替换规则，定义被替换的内容和目标内容。")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 string 替换成 replacement")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sub_filter string replacement;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http,server,location")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("(2) sub_filter_last_modified")])]),s._v(" "),t("p",[s._v("表示允许在替换期间保留原始响应中的“Last-Modified”头字段，以便于响应缓存")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sub_filter_last_modified on | off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sub_filter_last_modified off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http,server,location")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("(3) sub_filter_once")])]),s._v(" "),t("p",[s._v("是否只替换第一次匹配的字符串，关闭表示替换所有匹配的")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sub_filter_once on | off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ssub_filter_once on;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http,server,location")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("(3) sub_filter_types")])]),s._v(" "),t("p",[s._v("配置替换文件类型，“*”表示匹配所有MIME类型")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sub_filter_types mime-type ...;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sub_filter_types text/html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http,server,location")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("配置示例")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sub_filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'java'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'JAVA'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sub_filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'打call'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'打电话'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sub_filter_once")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"_1-8-nginx连接、请求限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-nginx连接、请求限制"}},[s._v("#")]),s._v(" 1.8 Nginx连接、请求限制")]),s._v(" "),t("h3",{attrs:{id:"_1-8-1-http协议的连接与请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-1-http协议的连接与请求"}},[s._v("#")]),s._v(" 1.8.1 HTTP协议的连接与请求")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/30/rLNbzd.png",alt:"image-20201230140502471"}})]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("HTTP请求建立在一次TCP连接基础上")]),s._v(" "),t("li",[s._v("一次TCP请求至少产生一次HTTP请求")])])]),s._v(" "),t("p",[t("strong",[s._v("TCP三次握手")])]),s._v(" "),t("ol",[t("li",[s._v("第一次：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。")]),s._v(" "),t("li",[s._v("第二次：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；")]),s._v(" "),t("li",[s._v("第三次：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。")])]),s._v(" "),t("p",[s._v("完成三次握手，客户端与服务器开始传送数据，在上述过程中，还有一些重要的概念：")]),s._v(" "),t("p",[t("strong",[s._v("TCP状态标识位")])]),s._v(" "),t("ul",[t("li",[s._v("YN表示建立连接")]),s._v(" "),t("li",[s._v("FIN表示关闭连接")]),s._v(" "),t("li",[s._v("ACK表示响应，")]),s._v(" "),t("li",[s._v("PSH表示有DATA数据传输")]),s._v(" "),t("li",[s._v("RST表示连接重置。")])]),s._v(" "),t("p",[t("strong",[s._v("位码")]),s._v("，即tcp标志位，有6种标示：")]),s._v(" "),t("ul",[t("li",[s._v("SYN(synchronous建立联机)")]),s._v(" "),t("li",[s._v("ACK(acknowledgement 确认)")]),s._v(" "),t("li",[s._v("PSH(push传送)")]),s._v(" "),t("li",[s._v("FIN(finish结束)")]),s._v(" "),t("li",[s._v("RST(reset重置)")]),s._v(" "),t("li",[s._v("URG(urgent紧急)")]),s._v(" "),t("li",[s._v("Sequence number(顺序号码)")]),s._v(" "),t("li",[s._v("Acknowledge number(确认号码)")])]),s._v(" "),t("p",[s._v("HTTP版本差异：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("HTTP协议版本")]),s._v(" "),t("th",[s._v("连接关系")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("HTTP1.0")]),s._v(" "),t("td",[s._v("TCP不能复用")])]),s._v(" "),t("tr",[t("td",[s._v("HTTP1.1")]),s._v(" "),t("td",[s._v("顺序性TCP复用")])]),s._v(" "),t("tr",[t("td",[s._v("HTTP2.0")]),s._v(" "),t("td",[s._v("多路复用TCP复用")])])])]),s._v(" "),t("h3",{attrs:{id:"_1-8-2-连接限制相关配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-2-连接限制相关配置"}},[s._v("#")]),s._v(" 1.8.2 连接限制相关配置")]),s._v(" "),t("p",[t("strong",[s._v("(1) limit_conn_zone")])]),s._v(" "),t("p",[s._v("设置共享内存区域的参数，该区域将保留各种key的状态，用来限制请求用。\n具体而言，状态包括当前连接数。key可以包含文本、变量及其组合。key值为空的请求不被计算在内。")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("limit_conn_zone key zone=name:size;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#定义一个10m大小名为"addr"的共享空间，用以存放连接状态，状态以$binary_remote_addr作为key\nlimit_conn_zone $binary_remote_addr zone=addr:10m;\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html#limit_conn_zone")])]),s._v(" "),t("p",[t("strong",[s._v("(2) limit_conn")])]),s._v(" "),t("p",[s._v("为给定的key值设置共享内存空间和允许的最大连接数。\n当超过此限制时，服务器将在响应请求时返回错误。")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("limit_conn zone number;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sub_filter_types text/html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http,server,location")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#参看上一项配置，将连接状态保存在"addr"共享空间中')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_conn_zone")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$binary_remote_addr")]),s._v(" zone=addr:10m")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /download/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#设置共享空间为"addr，允许并发连接数最大为10个')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_conn")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("blockquote",[t("p",[s._v("http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html#limit_conn")])]),s._v(" "),t("h3",{attrs:{id:"_1-8-3-请求限制相关配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-3-请求限制相关配置"}},[s._v("#")]),s._v(" 1.8.3 请求限制相关配置")]),s._v(" "),t("p",[t("strong",[s._v("(1) limit_req_zone")])]),s._v(" "),t("p",[s._v("设置共享内存区域的参数，该区域将保留各种key的状态。该状态存储当前超出的请求数量。\nkey可以包含文本、变量及其组合。key值为空的请求不被计算在内")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("limit_req_zone key zone=name:size rate=rate [sync];")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#定义10大小名为"one"的共享空间，用以存放请求状态，状态以$binary_remote_addr作为key，并且该空间的平均请求处理速率不能超过 1 request/s\nlimit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("(2) limit_req")])]),s._v(" "),t("p",[s._v("配置共享内存突发请求的大小和最大值。\n如果请求速率超过空间配置的速率，则其处理将延迟，以便以规定的速率处理请求。\n超出的请求会被延迟，直到它们的数量超过最大突发大小，在这种情况下，请求会因错误而终止。\n默认情况下，最大突发大小等于零。")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[burst=number] 表示突发请求数（最大请求数）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[nodelay | delay=number] 其中nodelay表示请求没有延迟，超出的请求丢失；delay=number表示可以延迟处理请求的数量。默认值为delay=0，即所有多余的请求都被延迟")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Syntax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("llimit_req zone=name [burst=number] [nodelay | delay=number];")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#平均每秒允许不超过1个请求")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_req_zone")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$binary_remote_addr")]),s._v(" zone=one:10m rate=1r/s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /search/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#突发请求不超过5个")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit_req")]),s._v(" zone=one burst=5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("测试")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用ab工具，发起并发请求，请求总数50个，同时并发20个")]),s._v("\nab "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" http://localhost\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_1-9-nginx访问控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-9-nginx访问控制"}},[s._v("#")]),s._v(" 1.9 Nginx访问控制")]),s._v(" "),t("ul",[t("li",[s._v("基于IP的访问控制：http_access_module")]),s._v(" "),t("li",[s._v("基于用户的信任登录：http_auth_basic_module")])]),s._v(" "),t("h3",{attrs:{id:"_1-9-1-基于ip的访问控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-9-1-基于ip的访问控制"}},[s._v("#")]),s._v(" 1.9.1 基于ip的访问控制")]),s._v(" "),t("p",[s._v("使用 http_access_module 配置基于ip的访问控制")]),s._v(" "),t("p",[t("strong",[s._v("(1) allow")])]),s._v(" "),t("p",[s._v("允许指定ip、网段、socket访问")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Syntax:      allow address | CIDR | unix: | all;\nDefault:     -\nContext:     http, server, location, limit_except\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("(2) deny")])]),s._v(" "),t("p",[s._v("拒绝指定ip、网段、socket访问")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Syntax:      deny address | CIDR | unix: | all;\nDefault:     -\nContext:     http, server, location, limit_except\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("示例")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v("  192.168.1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 192.168.1.0/24")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 10.1.1.0/16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 2001:0db8::/32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v("  all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("strong",[s._v("http_access_module的局限性")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/30/rOGLTS.png",alt:"image-20201230163338032"}})]),s._v(" "),t("p",[s._v("上图所示如果限制了IP1不能访问，nginx是使用http请求头的remote_addr进行ip限制的。但如果IP1使用IP2进行代理访问，IP2没有被限制，IP1就能拿通过代理访问到资源。")]),s._v(" "),t("p",[s._v("在此介绍x_forwarded_for")]),s._v(" "),t("p",[s._v("X-Forwarded-For（XFF）是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。")]),s._v(" "),t("p",[s._v("简而言之，就是可以追踪你的请求链路经过了哪几个IP，如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s3.ax1x.com/2020/12/30/rOGjYQ.png",alt:"image-20201230163859048"}})]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http_xforwarded for =Client IP,Proxy(1)IP,Proxy(2)IP,..\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如何解决 http_access_module 的局限性？")]),s._v(" "),t("ul",[t("li",[s._v("方法一：采用别的HTTP头信息控制访问，如：HTTP-_XFORWARD_FOR（客户端不一定支持，也有被修改的可能）")]),s._v(" "),t("li",[s._v("方法二：结合geo模块作")]),s._v(" "),t("li",[s._v("方法三：通过HTTP自定义变量传递")])]),s._v(" "),t("h3",{attrs:{id:"_1-9-2-基于用户认证访问控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-9-2-基于用户认证访问控制"}},[s._v("#")]),s._v(" 1.9.2 基于用户认证访问控制")]),s._v(" "),t("p",[s._v("使用http_auth_basic_module配置基于用户认证的访问控制")]),s._v(" "),t("p",[t("strong",[s._v("(1) auth_basic")])]),s._v(" "),t("p",[s._v("是否开启身份认证，开启的话，指定认证失败的提示语")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#off表示关闭，string是认证失败的提示语\nSyntax:      auth_basic string | off;\nDefault:     auth_basic off;\nContext:     http, server, location, limit_except\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("(2) auth_basic_user_file")])]),s._v(" "),t("p",[s._v("指定认证用户名密码的存放文件路径")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#file表示用户名密码文件\nSyntax:      auth_basic_user_file file;\nDefault:     -\nContext:     http, server, location, limit_except\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("用户名密码文件规则：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#comment")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("name1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("password1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("name2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("password2:comment")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("name3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("password3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("示例")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#开启身份认证，失败提示语为 "auth error!"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auth_basic")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"auth error!"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定用户名密码文件路径")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auth_basic_user_file")]),s._v(" conf/htpasswd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("http_access_module的局限性")])]),s._v(" "),t("ol",[t("li",[s._v("用户信息依赖文件方式")]),s._v(" "),t("li",[s._v("操作管理机械，效率低下")])]),s._v(" "),t("p",[s._v("解决方案")]),s._v(" "),t("ul",[t("li",[s._v("方案一：Nginx结合LUA实现高效验证")]),s._v(" "),t("li",[s._v("方案二：Nginx和LDAP打通，利用nginx-auth-ldap模块")])])])}),[],!1,null,null,null);t.default=e.exports}}]);