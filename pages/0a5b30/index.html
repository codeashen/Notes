<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第04章-Redis其他功能 | CodeAshen&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="后端技术博客,专注后端技术学习与总结。Java,Python,JavaScript,TypeScript,Spring,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="后端博客,个人技术博客,后端,后端开发,后端框架,后端面试题,技术文档,学习,面试,Java,Python,JavaScript,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d9c8cf8c.css" as="style"><link rel="preload" href="/assets/js/app.973ec296.js" as="script"><link rel="preload" href="/assets/js/2.6aaa6d1e.js" as="script"><link rel="preload" href="/assets/js/66.b3dfda7e.js" as="script"><link rel="prefetch" href="/assets/js/10.c128a7de.js"><link rel="prefetch" href="/assets/js/100.c5332952.js"><link rel="prefetch" href="/assets/js/101.472590ad.js"><link rel="prefetch" href="/assets/js/102.f697d18e.js"><link rel="prefetch" href="/assets/js/103.d8218fae.js"><link rel="prefetch" href="/assets/js/104.8851b38a.js"><link rel="prefetch" href="/assets/js/105.e9164174.js"><link rel="prefetch" href="/assets/js/106.fb403dea.js"><link rel="prefetch" href="/assets/js/107.ea7dbfb9.js"><link rel="prefetch" href="/assets/js/108.841273d4.js"><link rel="prefetch" href="/assets/js/109.a01a78fe.js"><link rel="prefetch" href="/assets/js/11.8d1708c7.js"><link rel="prefetch" href="/assets/js/110.8f5d172e.js"><link rel="prefetch" href="/assets/js/111.524e2bcf.js"><link rel="prefetch" href="/assets/js/112.b8a747e9.js"><link rel="prefetch" href="/assets/js/113.a9b1b9a0.js"><link rel="prefetch" href="/assets/js/114.7e4041d8.js"><link rel="prefetch" href="/assets/js/115.e2882f73.js"><link rel="prefetch" href="/assets/js/116.1d415864.js"><link rel="prefetch" href="/assets/js/117.71e63524.js"><link rel="prefetch" href="/assets/js/118.8986f793.js"><link rel="prefetch" href="/assets/js/119.80bcd61e.js"><link rel="prefetch" href="/assets/js/12.0132831e.js"><link rel="prefetch" href="/assets/js/120.dc2754a6.js"><link rel="prefetch" href="/assets/js/121.1dbe4441.js"><link rel="prefetch" href="/assets/js/122.446eb0a0.js"><link rel="prefetch" href="/assets/js/123.bac389f3.js"><link rel="prefetch" href="/assets/js/124.c087aa83.js"><link rel="prefetch" href="/assets/js/125.dcec8498.js"><link rel="prefetch" href="/assets/js/126.7e932ea3.js"><link rel="prefetch" href="/assets/js/127.2ae0bcd8.js"><link rel="prefetch" href="/assets/js/128.2d4ad1d9.js"><link rel="prefetch" href="/assets/js/129.4d6a08f8.js"><link rel="prefetch" href="/assets/js/13.209ff1e9.js"><link rel="prefetch" href="/assets/js/130.8936ad8a.js"><link rel="prefetch" href="/assets/js/131.11ca372c.js"><link rel="prefetch" href="/assets/js/132.9be75880.js"><link rel="prefetch" href="/assets/js/133.9955d166.js"><link rel="prefetch" href="/assets/js/134.5be1b51a.js"><link rel="prefetch" href="/assets/js/135.d0f8d2e0.js"><link rel="prefetch" href="/assets/js/136.ca304a24.js"><link rel="prefetch" href="/assets/js/137.1a0a904c.js"><link rel="prefetch" href="/assets/js/138.8ab30fee.js"><link rel="prefetch" href="/assets/js/139.cf78c4d4.js"><link rel="prefetch" href="/assets/js/14.d6134190.js"><link rel="prefetch" href="/assets/js/140.6c61677f.js"><link rel="prefetch" href="/assets/js/141.51ef4f6a.js"><link rel="prefetch" href="/assets/js/142.5a2feec0.js"><link rel="prefetch" href="/assets/js/143.f7200d74.js"><link rel="prefetch" href="/assets/js/144.1c36af9b.js"><link rel="prefetch" href="/assets/js/145.2ba88ed7.js"><link rel="prefetch" href="/assets/js/146.7ddd636f.js"><link rel="prefetch" href="/assets/js/147.835c06fe.js"><link rel="prefetch" href="/assets/js/148.5bfc3184.js"><link rel="prefetch" href="/assets/js/149.15658978.js"><link rel="prefetch" href="/assets/js/15.10140158.js"><link rel="prefetch" href="/assets/js/150.f1414565.js"><link rel="prefetch" href="/assets/js/151.6fe4a9f2.js"><link rel="prefetch" href="/assets/js/152.0694636f.js"><link rel="prefetch" href="/assets/js/153.d4a79e2b.js"><link rel="prefetch" href="/assets/js/154.f49c40b1.js"><link rel="prefetch" href="/assets/js/155.11c4af47.js"><link rel="prefetch" href="/assets/js/156.17a27449.js"><link rel="prefetch" href="/assets/js/157.03222e94.js"><link rel="prefetch" href="/assets/js/158.fd10abd2.js"><link rel="prefetch" href="/assets/js/159.7854cf98.js"><link rel="prefetch" href="/assets/js/16.deabf74a.js"><link rel="prefetch" href="/assets/js/160.bcceda6c.js"><link rel="prefetch" href="/assets/js/161.827af027.js"><link rel="prefetch" href="/assets/js/162.855aca43.js"><link rel="prefetch" href="/assets/js/163.72d27148.js"><link rel="prefetch" href="/assets/js/164.3e01c09c.js"><link rel="prefetch" href="/assets/js/165.e652258b.js"><link rel="prefetch" href="/assets/js/166.ecaa4581.js"><link rel="prefetch" href="/assets/js/167.e8ff99fa.js"><link rel="prefetch" href="/assets/js/168.02abfd0d.js"><link rel="prefetch" href="/assets/js/169.8fbd2db6.js"><link rel="prefetch" href="/assets/js/17.f69b8f6b.js"><link rel="prefetch" href="/assets/js/170.69e15007.js"><link rel="prefetch" href="/assets/js/171.cf706d56.js"><link rel="prefetch" href="/assets/js/172.3e4c3668.js"><link rel="prefetch" href="/assets/js/173.6ff18f12.js"><link rel="prefetch" href="/assets/js/174.453f4245.js"><link rel="prefetch" href="/assets/js/175.063163ca.js"><link rel="prefetch" href="/assets/js/176.edf6516c.js"><link rel="prefetch" href="/assets/js/177.c6ea414e.js"><link rel="prefetch" href="/assets/js/178.da8150fd.js"><link rel="prefetch" href="/assets/js/179.98958ecb.js"><link rel="prefetch" href="/assets/js/18.1a578fab.js"><link rel="prefetch" href="/assets/js/180.a98d2988.js"><link rel="prefetch" href="/assets/js/181.e7d9677d.js"><link rel="prefetch" href="/assets/js/182.dcae9e42.js"><link rel="prefetch" href="/assets/js/183.aee29579.js"><link rel="prefetch" href="/assets/js/184.98755068.js"><link rel="prefetch" href="/assets/js/185.82f47215.js"><link rel="prefetch" href="/assets/js/186.442d78c2.js"><link rel="prefetch" href="/assets/js/187.b37b3a63.js"><link rel="prefetch" href="/assets/js/188.b2405297.js"><link rel="prefetch" href="/assets/js/189.b3b59e8a.js"><link rel="prefetch" href="/assets/js/19.395617bc.js"><link rel="prefetch" href="/assets/js/190.ca137199.js"><link rel="prefetch" href="/assets/js/191.aa8a7422.js"><link rel="prefetch" href="/assets/js/192.270c2e56.js"><link rel="prefetch" href="/assets/js/193.e9d382d3.js"><link rel="prefetch" href="/assets/js/194.4d804198.js"><link rel="prefetch" href="/assets/js/195.b5b758e9.js"><link rel="prefetch" href="/assets/js/196.81bdc47b.js"><link rel="prefetch" href="/assets/js/197.3dd5c487.js"><link rel="prefetch" href="/assets/js/198.49c5c5e0.js"><link rel="prefetch" href="/assets/js/199.e4e9ff5b.js"><link rel="prefetch" href="/assets/js/20.af9c51b5.js"><link rel="prefetch" href="/assets/js/200.137782e2.js"><link rel="prefetch" href="/assets/js/201.cb4e5b2b.js"><link rel="prefetch" href="/assets/js/202.51abb277.js"><link rel="prefetch" href="/assets/js/203.83ed2d8a.js"><link rel="prefetch" href="/assets/js/21.cac71621.js"><link rel="prefetch" href="/assets/js/22.c51a3f6c.js"><link rel="prefetch" href="/assets/js/23.d9987c58.js"><link rel="prefetch" href="/assets/js/24.0b2c6cb2.js"><link rel="prefetch" href="/assets/js/25.c5aaf6b9.js"><link rel="prefetch" href="/assets/js/26.c4307053.js"><link rel="prefetch" href="/assets/js/27.27c8f8d4.js"><link rel="prefetch" href="/assets/js/28.b884b191.js"><link rel="prefetch" href="/assets/js/29.11a7cac3.js"><link rel="prefetch" href="/assets/js/3.52039520.js"><link rel="prefetch" href="/assets/js/30.e0296187.js"><link rel="prefetch" href="/assets/js/31.f612d60e.js"><link rel="prefetch" href="/assets/js/32.da15f932.js"><link rel="prefetch" href="/assets/js/33.06c4feab.js"><link rel="prefetch" href="/assets/js/34.fa726970.js"><link rel="prefetch" href="/assets/js/35.5dfa35dd.js"><link rel="prefetch" href="/assets/js/36.e8ee6c32.js"><link rel="prefetch" href="/assets/js/37.f34d8356.js"><link rel="prefetch" href="/assets/js/38.db8e9d1d.js"><link rel="prefetch" href="/assets/js/39.2d902803.js"><link rel="prefetch" href="/assets/js/4.94dce7a4.js"><link rel="prefetch" href="/assets/js/40.9b2c544f.js"><link rel="prefetch" href="/assets/js/41.bce99484.js"><link rel="prefetch" href="/assets/js/42.a0c6c78b.js"><link rel="prefetch" href="/assets/js/43.4e6aa9e5.js"><link rel="prefetch" href="/assets/js/44.ef9352e3.js"><link rel="prefetch" href="/assets/js/45.ae779112.js"><link rel="prefetch" href="/assets/js/46.fb4a183c.js"><link rel="prefetch" href="/assets/js/47.fae1056f.js"><link rel="prefetch" href="/assets/js/48.56b0b378.js"><link rel="prefetch" href="/assets/js/49.a6f88870.js"><link rel="prefetch" href="/assets/js/5.e01aaa8d.js"><link rel="prefetch" href="/assets/js/50.83e82362.js"><link rel="prefetch" href="/assets/js/51.e9419834.js"><link rel="prefetch" href="/assets/js/52.a1967369.js"><link rel="prefetch" href="/assets/js/53.94af57c3.js"><link rel="prefetch" href="/assets/js/54.b50e8783.js"><link rel="prefetch" href="/assets/js/55.8063724b.js"><link rel="prefetch" href="/assets/js/56.76bf8a2a.js"><link rel="prefetch" href="/assets/js/57.f9f3f777.js"><link rel="prefetch" href="/assets/js/58.f5fc8f65.js"><link rel="prefetch" href="/assets/js/59.6d369d87.js"><link rel="prefetch" href="/assets/js/6.07a7065d.js"><link rel="prefetch" href="/assets/js/60.5d94a162.js"><link rel="prefetch" href="/assets/js/61.0ad7c924.js"><link rel="prefetch" href="/assets/js/62.85956477.js"><link rel="prefetch" href="/assets/js/63.7e5be0fc.js"><link rel="prefetch" href="/assets/js/64.fbae5632.js"><link rel="prefetch" href="/assets/js/65.ddcfdbe6.js"><link rel="prefetch" href="/assets/js/67.6ee30a4e.js"><link rel="prefetch" href="/assets/js/68.71e1e060.js"><link rel="prefetch" href="/assets/js/69.4ed5537a.js"><link rel="prefetch" href="/assets/js/7.7a33a5a5.js"><link rel="prefetch" href="/assets/js/70.ad84b59a.js"><link rel="prefetch" href="/assets/js/71.136b2322.js"><link rel="prefetch" href="/assets/js/72.49c8fc99.js"><link rel="prefetch" href="/assets/js/73.7b0351b5.js"><link rel="prefetch" href="/assets/js/74.e7a0ce34.js"><link rel="prefetch" href="/assets/js/75.fc40be0c.js"><link rel="prefetch" href="/assets/js/76.bc90d4b8.js"><link rel="prefetch" href="/assets/js/77.0cb653a2.js"><link rel="prefetch" href="/assets/js/78.b692f5f9.js"><link rel="prefetch" href="/assets/js/79.effdc1de.js"><link rel="prefetch" href="/assets/js/8.17467f67.js"><link rel="prefetch" href="/assets/js/80.87603bda.js"><link rel="prefetch" href="/assets/js/81.4c9aac1e.js"><link rel="prefetch" href="/assets/js/82.54ab2e24.js"><link rel="prefetch" href="/assets/js/83.d34317d2.js"><link rel="prefetch" href="/assets/js/84.093a866c.js"><link rel="prefetch" href="/assets/js/85.dfe1b6bc.js"><link rel="prefetch" href="/assets/js/86.ffef04fb.js"><link rel="prefetch" href="/assets/js/87.52805dce.js"><link rel="prefetch" href="/assets/js/88.dd97eda8.js"><link rel="prefetch" href="/assets/js/89.425cc035.js"><link rel="prefetch" href="/assets/js/9.a64e81dc.js"><link rel="prefetch" href="/assets/js/90.3e58b256.js"><link rel="prefetch" href="/assets/js/91.711a6bba.js"><link rel="prefetch" href="/assets/js/92.3cc169cd.js"><link rel="prefetch" href="/assets/js/93.4e7bbb8c.js"><link rel="prefetch" href="/assets/js/94.e5c6ff23.js"><link rel="prefetch" href="/assets/js/95.adc48da9.js"><link rel="prefetch" href="/assets/js/96.84e8c33b.js"><link rel="prefetch" href="/assets/js/97.61e63949.js"><link rel="prefetch" href="/assets/js/98.fc0fb11b.js"><link rel="prefetch" href="/assets/js/99.b473d996.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9c8cf8c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="CodeAshen's blog" class="logo"> <span class="site-name can-hide">CodeAshen's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><a href="/spring/" class="link-title">Spring</a> <span class="title" style="display:none;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32011a/" class="nav-link">《剖析Spring5核心原理》</a></li><li class="dropdown-subitem"><a href="/pages/af2fa0/" class="nav-link">《Spring源码轻松学》</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a18a7b/" class="nav-link">Spring Boot 2.0深度实践</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f31975/" class="nav-link">Spring Cloud</a></li><li class="dropdown-subitem"><a href="/pages/722430/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/630854/" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/pages/9b3698/" class="nav-link">RocketMQ</a></li><li class="dropdown-item"><!----> <a href="/pages/c42700/" class="nav-link">Kafka</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4d1915/" class="nav-link">MySQL8.0详解</a></li><li class="dropdown-item"><!----> <a href="/pages/726b8d/" class="nav-link">Redis从入门到高可用</a></li><li class="dropdown-item"><!----> <a href="/pages/734bee/" class="nav-link">Elastic Stack</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="内功心法" class="dropdown-title"><a href="/foundation/" class="link-title">内功心法</a> <span class="title" style="display:none;">内功心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud-native/" class="nav-link">云原生</a></li><li class="dropdown-item"><!----> <a href="/devops/" class="nav-link">Devops</a></li><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">实用工具</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/reference/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><!----> <a href="/reference/" class="nav-link">Reference</a></li></ul></div></div> <a href="https://github.com/codeashen/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/codeashen/img-store/master/blog/public/avatar.jpg"> <div class="blogger-info"><h3>CodeAshen</h3> <span>后端界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><a href="/spring/" class="link-title">Spring</a> <span class="title" style="display:none;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/32011a/" class="nav-link">《剖析Spring5核心原理》</a></li><li class="dropdown-subitem"><a href="/pages/af2fa0/" class="nav-link">《Spring源码轻松学》</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a18a7b/" class="nav-link">Spring Boot 2.0深度实践</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f31975/" class="nav-link">Spring Cloud</a></li><li class="dropdown-subitem"><a href="/pages/722430/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/630854/" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/pages/9b3698/" class="nav-link">RocketMQ</a></li><li class="dropdown-item"><!----> <a href="/pages/c42700/" class="nav-link">Kafka</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4d1915/" class="nav-link">MySQL8.0详解</a></li><li class="dropdown-item"><!----> <a href="/pages/726b8d/" class="nav-link">Redis从入门到高可用</a></li><li class="dropdown-item"><!----> <a href="/pages/734bee/" class="nav-link">Elastic Stack</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="内功心法" class="dropdown-title"><a href="/foundation/" class="link-title">内功心法</a> <span class="title" style="display:none;">内功心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud-native/" class="nav-link">云原生</a></li><li class="dropdown-item"><!----> <a href="/devops/" class="nav-link">Devops</a></li><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">实用工具</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/reference/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><!----> <a href="/reference/" class="nav-link">Reference</a></li></ul></div></div> <a href="https://github.com/codeashen/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL8.0详解与实战</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL面试指南</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis从入门到高可用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/726b8d/" class="sidebar-link">第01章-初识Redis</a></li><li><a href="/pages/9e9f2b/" class="sidebar-link">第02章-API理解和使用</a></li><li><a href="/pages/45a245/" class="sidebar-link">第03章-Redis客户端</a></li><li><a href="/pages/0a5b30/" aria-current="page" class="active sidebar-link">第04章-Redis其他功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_1-1-请求的生命周期" class="sidebar-link">1.1 请求的生命周期</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_1-2-慢查询配置" class="sidebar-link">1.2 慢查询配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0a5b30/#slowlog-max-len" class="sidebar-link">slowlog-max-len</a></li><li class="sidebar-sub-header level3"><a href="/pages/0a5b30/#slowlog-log-slower-than" class="sidebar-link">slowlog-log-slower-than</a></li><li class="sidebar-sub-header level3"><a href="/pages/0a5b30/#配置方式" class="sidebar-link">配置方式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_1-3-慢查询命令" class="sidebar-link">1.3 慢查询命令</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_1-4-运维经验" class="sidebar-link">1.4 运维经验</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_2-1-什么是流水线" class="sidebar-link">2.1 什么是流水线</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_2-2-流水线的作用" class="sidebar-link">2.2 流水线的作用</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_2-3-java-中使用-pipeline" class="sidebar-link">2.3 Java 中使用 pipeline</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_2-4-pipeline-和批量操作" class="sidebar-link">2.4 pipeline 和批量操作</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_2-5-pipeline-注意事项" class="sidebar-link">2.5 pipeline 注意事项</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_2-1-发布订阅模式" class="sidebar-link">2.1 发布订阅模式</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_2-2-发布订阅api" class="sidebar-link">2.2 发布订阅API</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_4-1-bitmap-位图" class="sidebar-link">4.1 Bitmap 位图</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_4-2-位图-api" class="sidebar-link">4.2 位图 API</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_4-3-独立用户统计" class="sidebar-link">4.3 独立用户统计</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_4-4-bitmap-使用经验" class="sidebar-link">4.4 Bitmap 使用经验</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_5-1-hyperloglog-介绍和使用" class="sidebar-link">5.1 HyperLoglog 介绍和使用</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_5-2-使用经验" class="sidebar-link">5.2 使用经验</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_6-1-geo-的-api" class="sidebar-link">6.1 GEO 的 API</a></li><li class="sidebar-sub-header level2"><a href="/pages/0a5b30/#_6-2-使用说明" class="sidebar-link">6.2 使用说明</a></li></ul></li><li><a href="/pages/dc120a/" class="sidebar-link">第05章-Redis持久化</a></li><li><a href="/pages/a290a1/" class="sidebar-link">第06章-Redis主从复制</a></li><li><a href="/pages/21251e/" class="sidebar-link">第07章-Redis Sentinel</a></li><li><a href="/pages/e0e5a1/" class="sidebar-link">第08章-Redis Cluster</a></li><li><a href="/pages/4ac27b/" class="sidebar-link">第09章-缓存设计与优化</a></li><li><a href="/pages/50c785/" class="sidebar-link">第10章-Cache Cloud</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Elastic-Stack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/database/#数据库" data-v-06225672>数据库</a></li><li data-v-06225672><a href="/database/#Redis从入门到高可用" data-v-06225672>Redis从入门到高可用</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/codeashen" target="_blank" title="作者" class="beLink" data-v-06225672>CodeAshen</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-02-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">第04章-Redis其他功能<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="一、慢查询"><a href="#一、慢查询" class="header-anchor">#</a> 一、慢查询</h1> <h2 id="_1-1-请求的生命周期"><a href="#_1-1-请求的生命周期" class="header-anchor">#</a> 1.1 请求的生命周期</h2> <p>客户端请求 redis 的一个完整生命周期：</p> <p><img src="https://z3.ax1x.com/2021/06/02/2MLRNn.png" alt="请求生命周期"></p> <ol><li>客户端发送命令</li> <li>命令到达 redis 中排队（单线程）</li> <li>执行命令</li> <li>返回结果到客户端</li></ol> <p>关于慢查询的两点说明：</p> <ul><li>慢查询发生在第 3 阶段</li> <li>客户端超时不一定慢查询，但慢查询是客户端超时的一个可能因素</li></ul> <h2 id="_1-2-慢查询配置"><a href="#_1-2-慢查询配置" class="header-anchor">#</a> 1.2 慢查询配置</h2> <p>redis 针对慢查询日志有两个配置，分别为 <code>slowlog-max-len</code> 和 <code>slowlog-log-slower-than</code></p> <h3 id="slowlog-max-len"><a href="#slowlog-max-len" class="header-anchor">#</a> slowlog-max-len</h3> <p><code>slowlog-max-len</code> 表示慢查询日志队列的固定长度。慢查询会记录进一个队列，特点如下：</p> <ol><li>先进先出的队列</li> <li>队列长度固定</li> <li><strong>队列保存在内存中</strong></li></ol> <p>如下图左边所示，如果一条命令执行时间超过 10000 微秒（<code>slowlog-log-slower-than</code>），则进入慢查询队列（<code>slowlog list</code>），队列的长度是 100（<code>slowlog-max-len</code>）。图中右边表示 <code>slowlog100</code> ~ <code>slowlog1</code> 的慢查询数据。</p> <p><img src="https://z3.ax1x.com/2021/06/02/2MO4IA.png" alt="慢查询日志记录过程"></p> <h3 id="slowlog-log-slower-than"><a href="#slowlog-log-slower-than" class="header-anchor">#</a> slowlog-log-slower-than</h3> <p><code>slowlog-log-slower-than</code> 表示慢查询阈值（单位：毫秒），有以下特点：</p> <ul><li><code>slowlog-log-slower-than=0</code>，记录所有的命令</li> <li><code>slowlog-log-slower-than&lt;0</code>，不记录任何命令</li></ul> <h3 id="配置方式"><a href="#配置方式" class="header-anchor">#</a> 配置方式</h3> <p>获取默认值：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> config get slowlog-max-len
 <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token string">&quot;slowlog-max-len&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token string">&quot;128&quot;</span>
<span class="token operator">&gt;</span> config get slowlog-log-slower-than
 <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token string">&quot;slowlog-log-slower-than&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token string">&quot;10000&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>配置方式一：修改配置文件，重启 redis</p></li> <li><p>配置方式一：动态配置，无需重启</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> config <span class="token builtin class-name">set</span> slowlog-max-len <span class="token number">1000</span>
<span class="token operator">&gt;</span> config <span class="token builtin class-name">set</span> slowlog-log-slower-than <span class="token number">1000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h2 id="_1-3-慢查询命令"><a href="#_1-3-慢查询命令" class="header-anchor">#</a> 1.3 慢查询命令</h2> <ul><li><code>slowlog get [n]</code>：获取慢查询队列记录</li> <li><code>slowlog len</code>：获取慢查询队列长度</li> <li><code>slowlog reset</code>：清空慢查询队列</li></ul> <h2 id="_1-4-运维经验"><a href="#_1-4-运维经验" class="header-anchor">#</a> 1.4 运维经验</h2> <ol><li><code>slowlog-log-slower-then</code> 不要设置过大，默认 10ms，通常设置 1ms</li> <li><code>slowlog-max-len</code> 不要设置过小，通常设置 1000 左右</li> <li>理解命令生命周期</li> <li>定期持久化慢查询日志（存在内存中的，持久化方便后续分析）</li></ol> <h1 id="二、pipeline-流水线"><a href="#二、pipeline-流水线" class="header-anchor">#</a> 二、pipeline 流水线</h1> <h2 id="_2-1-什么是流水线"><a href="#_2-1-什么是流水线" class="header-anchor">#</a> 2.1 什么是流水线</h2> <p>1 次网络命令通信模型</p> <p><img src="https://z3.ax1x.com/2021/06/02/2QMlCR.png" alt="1次网络命令通信模型"></p> <p>批量网络命令通信模型</p> <p><img src="https://z3.ax1x.com/2021/06/02/2QM7rT.png" alt="批量网络命令通信模型"></p> <p>流水线命令网络模型</p> <p><img src="https://z3.ax1x.com/2021/06/02/2QQBo4.png" alt="流水线命令网络模型"></p> <h2 id="_2-2-流水线的作用"><a href="#_2-2-流水线的作用" class="header-anchor">#</a> 2.2 流水线的作用</h2> <table><thead><tr><th>命令</th> <th>n 个命令操作</th> <th>1 次 pipeline（n 个命令）</th></tr></thead> <tbody><tr><td>时间</td> <td>n 次网络 + n 次命令</td> <td>1 次网络 + n 次命令</td></tr> <tr><td>数据量</td> <td>1 条命令</td> <td>n 条命令</td></tr></tbody></table> <p>注意两点：</p> <ol><li>redis 执行命令通常是微秒级别的</li> <li>pipeline 每次条数要控制（网络）</li></ol> <h2 id="_2-3-java-中使用-pipeline"><a href="#_2-3-java-中使用-pipeline" class="header-anchor">#</a> 2.3 Java 中使用 pipeline</h2> <p>引入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>场景：执行 10000 次 hset 操作，生成 10000 个哈希。（不能使用 hmset，hmset 是生成一个 hash，里面 n 个 field-value 对）</p> <p>不使用 pipeline 的情况，10000 次网络 + 10000 次命令，要 50s</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ======== 不使用 pipeline ========</span>
<span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;hashkey:&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">&quot;field&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>使用 pipeline，分 100 次，每次携带 100 条命令，100 次网络 + 10000 次命令，要 0.7s</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ======== 使用 pipeline ========</span>
<span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 分 100 次 pipeline 操作</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token class-name">Pipeline</span> pipeline <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">pipelined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 每次携带命令数量 100</span>
        pipeline<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;hashkey:&quot;</span> <span class="token operator">+</span> j<span class="token punctuation">,</span> <span class="token string">&quot;field&quot;</span> <span class="token operator">+</span> j<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span> <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 执行携带了 100 条命令的 pipeline</span>
    pipeline<span class="token punctuation">.</span><span class="token function">syncAndReturnAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_2-4-pipeline-和批量操作"><a href="#_2-4-pipeline-和批量操作" class="header-anchor">#</a> 2.4 pipeline 和批量操作</h2> <p>m 操作（批量操作）是一条命令，是原子的</p> <p><img src="https://z3.ax1x.com/2021/06/02/2QGEvR.png" alt="image-20210602155250161"></p> <p>pipeline 操作到达 redis 会被拆分，是非原子的</p> <p><img src="https://z3.ax1x.com/2021/06/02/2QG8xA.png" alt="image-20210602155409475"></p> <h2 id="_2-5-pipeline-注意事项"><a href="#_2-5-pipeline-注意事项" class="header-anchor">#</a> 2.5 pipeline 注意事项</h2> <ol><li>注意每次 pipeline 携带数据量</li> <li>pipeline 每次只能作用在一个 Redis 节点上</li> <li>注意 M 操作与 pipeline 区别</li></ol> <h1 id="三、发布订阅"><a href="#三、发布订阅" class="header-anchor">#</a> 三、发布订阅</h1> <h2 id="_2-1-发布订阅模式"><a href="#_2-1-发布订阅模式" class="header-anchor">#</a> 2.1 发布订阅模式</h2> <p>redis 发布订阅模式中有以下角色</p> <ul><li><strong>发布者（publisher）</strong>：发布消息频道</li> <li><strong>订阅者（subscriber）</strong>：订阅频道</li> <li><strong>频道（channel）</strong>：接收发布者的消息分发给订阅者</li></ul> <p>发布订阅消息模型：</p> <p><img src="https://z3.ax1x.com/2021/06/02/2Qwb5t.png" alt="image-20210602162428427"></p> <ul><li>发布者发布消息到频道 A，订阅频道 A 的所有订阅者都能收到消息</li> <li>redis 发布订阅模式没有消息堆积能力，订阅者只能收到订阅之后发出的消息。</li></ul> <h2 id="_2-2-发布订阅api"><a href="#_2-2-发布订阅api" class="header-anchor">#</a> 2.2 发布订阅API</h2> <ul><li><code>publish channel message</code>：发布消息到频道，返回订阅者个数</li> <li><code>subscribe [channel]</code>：订阅一个或多个频道，会收到消息和对应的频道</li> <li><code>unsubscribe [channel]</code>：取消订阅一个或多个频道</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ===== 发布消息 =====</span>
redis<span class="token operator">&gt;</span> publish sohu:tv <span class="token string">&quot;hello world&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span> <span class="token comment"># 订阅者个数 </span>
redis<span class="token operator">&gt;</span> publish sohu:auto <span class="token string">&quot;taxi&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span>

<span class="token comment"># ===== 订阅消息 =====</span>
redis<span class="token operator">&gt;</span> subscribe sohu:tv 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;sohu:tv&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;message&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;sohu:tv&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;hello world&quot;</span>

<span class="token comment"># ===== 取消订阅 =====</span>
redis<span class="token operator">&gt;</span> unsubscribe sohu:tv 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;unsubscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;sohu:tv&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span><span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>其他 API</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> psubscribe <span class="token punctuation">[</span>pattern<span class="token punctuation">..</span>.<span class="token punctuation">]</span>      <span class="token comment"># 订阅模式</span>
<span class="token operator">&gt;</span> punsubscribe <span class="token punctuation">[</span>pattern<span class="token punctuation">..</span>.<span class="token punctuation">]</span>    <span class="token comment"># 退订指定的模式</span>
<span class="token operator">&gt;</span> pubsub channels              <span class="token comment"># 列出至少有一个订阅者的频道</span>
<span class="token operator">&gt;</span> pubsub numsub <span class="token punctuation">[</span>channel<span class="token punctuation">..</span>.<span class="token punctuation">]</span>   <span class="token comment"># 列出给定频道的订阅者数量</span>
<span class="token operator">&gt;</span> pubsub numpat                <span class="token comment"># 列出被订阅模式的数量</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="四、bitmap"><a href="#四、bitmap" class="header-anchor">#</a> 四、Bitmap</h1> <h2 id="_4-1-bitmap-位图"><a href="#_4-1-bitmap-位图" class="header-anchor">#</a> 4.1 Bitmap 位图</h2> <p><strong>Bitmap 实际是字符串的二进制表示形式。</strong></p> <p><img src="https://z3.ax1x.com/2021/06/02/2Q4Q2Q.png" alt="image-20210602173612008"></p> <p>图中字符串 &quot;big&quot; 中字符 'b' 的 ASCII 码是 98，应对的二进制数是 01100010，其他字符同理，就得到了 &quot;big&quot; 的二进制表示。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> hello big    <span class="token comment"># 设置字符串，key: hello，value: big</span>
OK
<span class="token operator">&gt;</span> getbit hello <span class="token number">0</span>   <span class="token comment"># 获取 hello 值的第 0 位</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token operator">&gt;</span> getbit hello <span class="token number">1</span>   <span class="token comment"># 获取 hello 值的第 1 位</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上述命令，操作的就是字符串 &quot;big&quot; 对应的二进制。即在 redis 中，是可以直接操作位的。</p> <h2 id="_4-2-位图-api"><a href="#_4-2-位图-api" class="header-anchor">#</a> 4.2 位图 API</h2> <p><strong>命令一：setbit</strong></p> <p><code>setbit key offset value</code>：给位图指定索引设置值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> setbit unique:users:2016-04-05 <span class="token number">0</span> <span class="token number">1</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span> 
<span class="token operator">&gt;</span> setbit unique:users:2016-04-05 <span class="token number">5</span> <span class="token number">1</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span> 
<span class="token operator">&gt;</span> setbit unique:users:2016-04-05 <span class="token number">1</span> <span class="token number">11</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span> 
<span class="token operator">&gt;</span> setbit unique:users:2016-04-05 <span class="token number">15</span> <span class="token number">1</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span> 
<span class="token operator">&gt;</span> setbit unique:users:2016-04-05 <span class="token number">19</span> <span class="token number">1</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>设置的 offset 超过原来位图长度，会直接自动拉长，中间补零 0</strong>，如下图所示</p> <p><img src="https://z3.ax1x.com/2021/06/02/2Q576J.png" alt="image-20210602174332130"></p> <p><strong>命令二：getbit</strong></p> <p><code>getbit key offset</code>：获取位图指定索引的值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> getbit unique:users:2016-04-05 <span class="token number">8</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span> 
<span class="token operator">&gt;</span> getbit unique:users:2016-04-05 <span class="token number">19</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>命令三：bitcount</strong></p> <p><code>bitcount key [start end]</code>：获取位图指定范围位值为 1 的个数 （start 到 end，单位为字节，如果不指定就是获取全部）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> bitcount unique:users:2016-04-05 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span> 
<span class="token operator">&gt;</span> bitcount unique:users:2016-04-05 <span class="token number">1</span> <span class="token number">3</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>命令四：bitop</strong></p> <p><code>bitop op destkey key [key...]</code>： 做多个 Bitmap 的 and(交集）、or（并集）、not（非）、xor（异或） 操作并将结果保存在 destkey 中</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 并求两个位图的并集 </span>
<span class="token operator">&gt;</span> bitop and unique:users:and:2016_0404-2016_04_05 unique:users:2016-04-05 unique:users:2016-04-04 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token operator">&gt;</span> bitcount unique:users:and:2016_0404-2016_04_05 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>命令五：bitpos</strong></p> <p><code>bitpos key targetBit [start] [end]</code>： 计算位图指定范围第一个偏移量对应的值等于 targetBit 的位置 （start 到 end，单位为字节，如果不指定就是获取全部）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 类似于 indexOf</span>
<span class="token operator">&gt;</span> bitpos unique:users:2016-04-04 <span class="token number">1</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token operator">&gt;</span> bitpos unique:users:2016-04-04 <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_4-3-独立用户统计"><a href="#_4-3-独立用户统计" class="header-anchor">#</a> 4.3 独立用户统计</h2> <p>场景：某网站有 n 个用户，现需要记录每天访问的独立用户</p> <p>假设有一亿用户，5 千不同用户访问。要存储这一亿用户 id 中的 5 千万条，有以下方案：</p> <ul><li>set：将用户 id 存到 set 中去</li> <li>bitmap：bitmap 中每一位代表一个用户，先将所有的用户置 0，然后 1 代表用户访问了。</li></ul> <table><thead><tr><th>数据类型</th> <th>每个 userId 占用空间</th> <th>要存储的用户量</th> <th>所需内存</th></tr></thead> <tbody><tr><td>set</td> <td>32位（假设整型）</td> <td>50,000,000</td> <td>32位 * 50,000,000 = 200MB</td></tr> <tr><td>bitmap</td> <td>1位</td> <td>100,000,000</td> <td>1位 * 100,000,000 = 12.5MB</td></tr></tbody></table> <p>长期使用所需内存：</p> <table><thead><tr><th>数据类型</th> <th>一天</th> <th>一月</th> <th>一年</th></tr></thead> <tbody><tr><td>set</td> <td>200MB</td> <td>6G</td> <td>72G</td></tr> <tr><td>bitmap</td> <td>12.5MB</td> <td>375MB</td> <td>4.5G</td></tr></tbody></table> <p>如果是只有 10 万用户访问，那么：</p> <table><thead><tr><th>数据类型</th> <th>每个 userId 占用空间</th> <th>要存储的用户量</th> <th>所需内存</th></tr></thead> <tbody><tr><td>set</td> <td>32位（假设整型）</td> <td>100,000</td> <td>32位 * 100,000 = 4MB</td></tr> <tr><td>bitmap</td> <td>1位</td> <td>100,000,000</td> <td>1位 * 100,000,000 = 12.5MB</td></tr></tbody></table> <p>此时使用 set 更节省空间。</p> <h2 id="_4-4-bitmap-使用经验"><a href="#_4-4-bitmap-使用经验" class="header-anchor">#</a> 4.4 Bitmap 使用经验</h2> <ol><li>Bitmap 实际就是字符串，最大存储 512MB</li> <li>注意 setbit 时的偏移量，可能有较大耗时</li> <li>位图不是绝对好</li></ol> <h1 id="五、hyperloglog"><a href="#五、hyperloglog" class="header-anchor">#</a> 五、HyperLoglog</h1> <h2 id="_5-1-hyperloglog-介绍和使用"><a href="#_5-1-hyperloglog-介绍和使用" class="header-anchor">#</a> 5.1 HyperLoglog 介绍和使用</h2> <p>HyperLoglog 介绍</p> <ol><li><p>基于 HyperLoglog 算法：极小空间完成独立数据统计</p></li> <li><p>本质还是字符串</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">type</span> hyperloglog_key
string
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <p>三个相关命令</p> <ol><li><code>pfadd key element [element...]</code>：向 hyperloglog 添加元素</li> <li><code>pfcount key [key...]</code>：计算 hyperloglog 的独立总数</li> <li><code>pfmerge destkey sourcekey [sourcekey...]</code>：合并多个 hyperloglog</li></ol> <p>使用演示</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 操作3月5日的用户数据</span>
redis<span class="token operator">&gt;</span> pfadd 2017_03_06:unique:ids <span class="token string">&quot;uuid-1&quot;</span> <span class="token string">&quot;uuid-2&quot;</span> <span class="token string">&quot;uuid-3&quot;</span> <span class="token string">&quot;uuid-4&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> pfcount 2017_03_06:unique:ids 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span> 
redis<span class="token operator">&gt;</span> pfadd 2017_03_06:unique:ids <span class="token string">&quot;uuid-1&quot;</span> <span class="token string">&quot;uuid-2&quot;</span> <span class="token string">&quot;uuid-3&quot;</span> <span class="token string">&quot;uuid-90&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> pfcount 2017_03_06:unique:ids 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span>

<span class="token comment"># 操作3月6日的用户数据</span>
redis<span class="token operator">&gt;</span> pfadd 2016_03_06:unique:ids <span class="token string">&quot;uuid-1&quot;</span> <span class="token string">&quot;uuid-2&quot;</span> <span class="token string">&quot;uuid-3&quot;</span> <span class="token string">&quot;uuid-8&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> pfcount 2016_03_06:unique:ids 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span> 

<span class="token comment"># 合并数据</span>
redis<span class="token operator">&gt;</span> pfmerge 2016_03_05_06:unique:ids 2016_03_05:unique:ids 2016_03_06:unique:ids
OK
redis<span class="token operator">&gt;</span> pfcount 2016_03_05_06:unique:ids
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="_5-2-使用经验"><a href="#_5-2-使用经验" class="header-anchor">#</a> 5.2 使用经验</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># shell 脚本表，向 HyperLoglog 中插入百万数据</span>
<span class="token assign-left variable">elements</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token string">&quot;2016_05_01:unique:ids&quot;</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> 'seq <span class="token number">1</span> <span class="token number">1000000</span>`
<span class="token keyword">do</span> 
    <span class="token assign-left variable">elements</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${elements}</span> uuid-&quot;</span><span class="token variable">${i}</span> 
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token variable"><span class="token variable">$((</span>i <span class="token operator">%</span> <span class="token number">1000</span><span class="token variable">))</span></span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 
    <span class="token keyword">then</span> 
    	redis-cli pfadd <span class="token variable">${key}</span> <span class="token variable">${elements}</span> 
    	<span class="token assign-left variable">elements</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上述脚本插入百万数据后，HyperLoglog 仅仅占用 15KB 内存。</p> <p>使用 HyperLoglog 的局限：</p> <ol><li>是否能容忍错误？（错误率：0.81%）</li> <li>是否需要单条数据？（不能取出单条数据）</li></ol> <h1 id="六、geo"><a href="#六、geo" class="header-anchor">#</a> 六、GEO</h1> <p>GEO（地理信息定位）：存储经纬度，计算两地距离，范围计算等</p> <h2 id="_6-1-geo-的-api"><a href="#_6-1-geo-的-api" class="header-anchor">#</a> 6.1 GEO 的 API</h2> <p><strong>geoadd</strong></p> <p><code>geoadd key longitude latitude member [longitude latitude member...]</code> ：增加地理位置信息</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> geoadd cities:locations <span class="token number">116.28</span> <span class="token number">39.55</span> beijing 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
<span class="token operator">&gt;</span> geoadd cities:locations <span class="token number">116.28</span> <span class="token number">39.55</span> beijing 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
<span class="token operator">&gt;</span> geoadd cities:locations <span class="token number">117.12</span> <span class="token number">39.08</span> tianjin <span class="token number">114.29</span> <span class="token number">38.02</span> shijiazhuang <span class="token number">118.0139</span>.38 tangshan <span class="token number">115.29</span> <span class="token number">38.51</span> baoding 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>geopos</strong></p> <p><code>geopos key member [member...]</code>：获取地理位置信息</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> geopos cities:locations tianjin 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;117.12000042200088501&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;39.0800000535766543&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>geodist</strong></p> <p><code>geodist key member1 member2 [unit]</code>： 获取两个地理位置的距离，unit：m（米）、km（干米）、mi（英里）、ft（尺）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> geodist cities:locations tianjin beijing km 
<span class="token string">&quot;89.2061&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>georadius</strong></p> <p>georadius 以给定的经纬度为中心，返回键包含的位置元素当中，与中心的距离不超过给定最大距离的所有位置元素。</p> <p>API介绍：</p> <div class="language- extra-class"><pre><code>georadius key longitude latitude radiusm|km|ft|mi [withcoord] [withdist] [withhash] [COUNT count][asc|desc] [store key] [storedist key] 

georadiusbymember key member radiusm|km|ft|mi [withcoord] [withdist] [withhash] [COUNT count] [asc|desc] [store key] [storedist key] 

withcoord:     返回结果中包含经纬度。
withdist:      返回结果中包含距离中心节点位置。
withhash:      返回结果中包含 geohash COUNT count: 指定返回结果的数量。
ascldesc:      返回结果按照距离中心节点的距离做升序或者降序。
store key:     将返回结果的地理位置信息保存到指定键。
storedist key: 将返回结果距离中心节点的距离保存到指定键s
</code></pre></div><p>使用示例：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> georadiusbymember cities:locations beijing <span class="token number">150</span> km 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;beijing&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;tianjin&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;tangshan&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;baoding&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_6-2-使用说明"><a href="#_6-2-使用说明" class="header-anchor">#</a> 6.2 使用说明</h2> <ol><li>since 3.2+</li> <li>geo 是使用 zset 实现的，type geokey = zset</li> <li>没有删除 API，使用 zset 方式删除：<code>zrem key member</code></li></ol></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/codeashen/notes/edit/master/docs/03.数据库/20.Redis从入门到高可用/04.Redis其他功能.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/06/04, 12:34:19</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/45a245/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第03章-Redis客户端</div></a> <a href="/pages/dc120a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第05章-Redis持久化</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/45a245/" class="prev">第03章-Redis客户端</a></span> <span class="next"><a href="/pages/dc120a/">第05章-Redis持久化</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/630854/"><div>
            第01章-RabbitMQ导学
            <!----></div></a> <span class="date">02-10</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/c2f425/"><div>
            第02章-入门RabbitMQ核心概念
            <!----></div></a> <span class="date">02-10</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b09a03/"><div>
            第03章-RabbitMQ高级特性
            <!----></div></a> <span class="date">02-10</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:codeashen@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/codeashen" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://space.bilibili.com/7403658/" title="BiliBili" target="_blank" class="iconfont icon-bilibili"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2023
    <span>CodeAshen | <a href="https://github.com/codeashen/notes/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.973ec296.js" defer></script><script src="/assets/js/2.6aaa6d1e.js" defer></script><script src="/assets/js/66.b3dfda7e.js" defer></script>
  </body>
</html>
