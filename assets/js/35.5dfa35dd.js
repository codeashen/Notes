(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{360:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"一、rocketmq-整体介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、rocketmq-整体介绍"}},[s._v("#")]),s._v(" 一、RocketMQ 整体介绍")]),s._v(" "),a("ul",[a("li",[s._v("RocketMQ 是一款分布式、队列模型的消息中间件")]),s._v(" "),a("li",[s._v("支持集群模型、负载均衡、水平扩展能力")]),s._v(" "),a("li",[s._v("亿级别的消息堆积能力")]),s._v(" "),a("li",[s._v("采用零拷贝的原理、顺序写盘、随机读")]),s._v(" "),a("li",[s._v("丰富的API使用（同步消息、异步消息、顺序消息、延迟消息、事务消息）")]),s._v(" "),a("li",[s._v("代码优秀，底层通信框架采用Netty NIO框架")]),s._v(" "),a("li",[s._v("NameServer 代替 Zookeper")]),s._v(" "),a("li",[s._v("强调集群无单点，可扩展，任意一点高可用，水平可扩展")]),s._v(" "),a("li",[s._v("消息失败重试机制、消息可查询")]),s._v(" "),a("li",[s._v("开源社区活跃、成熟度（经过双十一考验）")])]),s._v(" "),a("h1",{attrs:{id:"二、rocketmq概念模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、rocketmq概念模型"}},[s._v("#")]),s._v(" 二、RocketMQ概念模型")]),s._v(" "),a("ul",[a("li",[s._v("**Producer：**消息生产者，负责生产消息，一般由业务系统负责产生消息。")]),s._v(" "),a("li",[s._v("**Consumer：**消息消费者，负责消费消息，一般是由后台系统负责异步消费。")]),s._v(" "),a("li",[s._v("**Push Consumer：**Consumer的一种，需要向Consumer对象注册监听。")]),s._v(" "),a("li",[s._v("**Pull Consumer：**Consumer的以中，需要主动请求Broker拉去消息。")]),s._v(" "),a("li",[s._v("**Producer Group：**生产者集合，一般用于发送一类消息。")]),s._v(" "),a("li",[s._v("**Consumer Group：**消费者集合，一般用于接受一类消息进行消费。")]),s._v(" "),a("li",[s._v("**Broker：**MQ消息服务（中转角色，用于消息存储与生产消息转发）。")])]),s._v(" "),a("p",[s._v("参考官方文档："),a("a",{attrs:{href:"https://github.com/apache/rocketmq/blob/master/docs/cn/concept.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("基本概念"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"三、rocketmq源码包结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、rocketmq源码包结构"}},[s._v("#")]),s._v(" 三、RocketMQ源码包结构")]),s._v(" "),a("ul",[a("li",[s._v("rocketmq-broker：主要的业务逻辑，消息收发，主从同步，pagecache")]),s._v(" "),a("li",[s._v("rocketmq-client：客户端接口，比如生产者和消费者")]),s._v(" "),a("li",[s._v("rocketmq-example：示例，比如生产者和消费者")]),s._v(" "),a("li",[s._v("rocketmq-common：公用数据结构等等")]),s._v(" "),a("li",[s._v("rocketmq-distribution：编译模块，编译输出等")]),s._v(" "),a("li",[s._v("rocketmq-fliter：进行Broker过滤的不感兴趣的消息传输，减小带宽压力")]),s._v(" "),a("li",[s._v("rocketmq-logappender、rocketmq-logging：日志相关")]),s._v(" "),a("li",[s._v("rocketmq-namesrv：Namesrv服务，用于服务协调")]),s._v(" "),a("li",[s._v("rocketmq-openmessaging：对外提供服务")]),s._v(" "),a("li",[s._v("rocketmq-remoting：远程调用接口，封装Netty底层通信")]),s._v(" "),a("li",[s._v("rocketmq-srvutil：提供一些公用的工具方法，比如解析命令行参数")]),s._v(" "),a("li",[s._v("rocketmq-store：消息存储")]),s._v(" "),a("li",[s._v("rocketmq-test、rocketmq-example：测试、示例")]),s._v(" "),a("li",[s._v("rocketmq-tools：管理工具，比如有名的mqadmin工具")])]),s._v(" "),a("h1",{attrs:{id:"四、rocketmq环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、rocketmq环境搭建"}},[s._v("#")]),s._v(" 四、RocketMQ环境搭建")]),s._v(" "),a("h2",{attrs:{id:"_4-1-rocketmq单节点搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-rocketmq单节点搭建"}},[s._v("#")]),s._v(" 4.1 RocketMQ单节点搭建")]),s._v(" "),a("p",[s._v("RocketMQ天然支持集群，这里我们使用单点为例，演示搭建过程")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("hosts添加信息")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置以下信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".36.123 rocketmq-nameserver1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("196.168")]),s._v(".36.123 rocketmq-master1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("上传解压")]),s._v(" "),a("p",[s._v("地址：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传 apache-rocketmq.tar.gz 文件至/usr/local")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" apache-rocketmq.tar.gz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" /usr/local\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立软连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" apache-rocketmq rocketmq\nll /usr/local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("创建存储路径")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/commitlog\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/consumequeue\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/index\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("RocketMQ配置文件")]),s._v(" "),a("p",[s._v("配置文件在 "),a("code",[s._v("${rocketmq_home}/conf")]),s._v(" 下，有不同集群模式的配置，我们复制一个，在此基础上修改")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" 2m-2s-async/ test-conf/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test-conf/broker-a.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("使用以下配置")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所属集群名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerClusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-cluster")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#broker 名字，注意此处不同的配置文件填写的不一样")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("broker-a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 表示 Master，>0 表示 Slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nameServer 地址，分号分割")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("namesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-nameserver1:9876")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在发送消息时，自动创建服务器不存在的 topic，默认创建的队列数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("defaultTopicQueueNums")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建 Topic，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateTopicEnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateSubscriptionGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 对外服务的监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("listenPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10911")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除文件时间点，默认凌晨 4 点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("deleteWhen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件保留时间，默认 48 小时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("fileReservedTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("120")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog 每个文件的大小默认 1G")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1073741824")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ConsumeQueue 每个文件默认存 30W 条，根据业务情况调整")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("300000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#destroyMapedFileIntervalForcibly=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redeleteHangedFileInterval=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测物理文件磁盘空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("diskMaxUsedSpaceRatio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathRootDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/usr/local/rocketmq/store")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog 存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/usr/local/rocketmq/store/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消费队列存储路径存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/usr/local/rocketmq/store/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消息索引存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/usr/local/rocketmq/store/index")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkpoint 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storeCheckpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/usr/local/rocketmq/store/checkpoint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#abort 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("abortFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/usr/local/rocketmq/store/abort")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制的消息大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("maxMessageSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("65536")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogLeastPages=4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueLeastPages=2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogThoroughInterval=10000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueThoroughInterval=60000")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_MASTER 异步复制 Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_MASTER 同步双写 Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerRole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ASYNC_MASTER")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷盘方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_FLUSH 异步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_FLUSH 同步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("flushDiskType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ASYNC_FLUSH")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkTransactionMessageEnable=false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sendMessageThreadPoolNums=128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pullMessageThreadPoolNums=128")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("修改日志配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /usr/local/rocketmq/logs\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#${user.home}#/usr/local/rocketmq#g'")]),s._v(" *.xml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("修改启动脚本参数")]),s._v(" "),a("p",[s._v("RocketMQ对内存要求较高，启动脚本配置的JVM内存很大，这里修改一下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改broker启动配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/rocketmq/bin/runbroker.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v('修改配置：JAVA_OPT="${JAVA_OPT} -server '),a("strong",[s._v("-Xms1g -Xmx1g -Xmn512m")]),s._v(' -XX:PermSize=128m - XX:MaxPermSize=320m"')])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改nameserver启动配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/rocketmq/bin/runserver.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v('修改配置：JAVA_OPT="${JAVA_OPT} -server '),a("strong",[s._v("-Xms1g -Xmx1g -Xmn512m")]),s._v(' -XX:PermSize=128m - XX:MaxPermSize=320m"')])])]),s._v(" "),a("li",[a("p",[s._v("启动 NameServer 和 Broker")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/bin\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先启动 NameServer")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqnamesrv "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再启动 broker，指定配置文件，以及输出")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /usr/local/rocketmq/conf/test-conf/broker-a.properties "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# jps命令查看java进程，验证")]),s._v("\njps\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("关闭进程和数据清理")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/bin\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqshutdown broker\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqshutdown namesrv\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --等待停止")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /usr/local/rocketmq/store\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/commitlog\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/consumequeue\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/index\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --按照上面步骤重启 NameServer 与 BrokerServer")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"_4-2-rocketmq控制台"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-rocketmq控制台"}},[s._v("#")]),s._v(" 4.2 RocketMQ控制台")]),s._v(" "),a("p",[s._v("官方提供的RocketMQ控制台，是一个SpringBoot项目，github地址："),a("a",{attrs:{href:"https://github.com/apache/rocketmq-externals",target:"_blank",rel:"noopener noreferrer"}},[s._v("rocketmq-externals"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("打包其中的 "),a("strong",[s._v("rocketmq-console")]),s._v(" 模块，"),a("code",[s._v("mvn clean package -Dmaven.test.skip=true")]),s._v("，在运行jar包即可")])])}),[],!1,null,null,null);a.default=n.exports}}]);