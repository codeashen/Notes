(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{376:function(t,s,a){"use strict";a.r(s);var e=a(4),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("优化SQL的一般步骤")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://z3.ax1x.com/2021/08/10/fYzkBd.png",alt:"image-20210810190556395"}})]),t._v(" "),s("h1",{attrs:{id:"一、发现问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、发现问题"}},[t._v("#")]),t._v(" 一、发现问题")]),t._v(" "),s("p",[t._v("常见问题发现渠道")]),t._v(" "),s("ul",[s("li",[t._v("用户主动上报应用性能问题")]),t._v(" "),s("li",[t._v("分析慢查询日志发现存在问题的SQL")]),t._v(" "),s("li",[t._v("数据库时实监控长时间运行的SQL")])]),t._v(" "),s("p",[t._v("配置MySQL慢查询日志")]),t._v(" "),s("p",[t._v("慢查询日志默认是关闭的，通过以下配置开启慢查询日志。")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" slow_query_log "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OFF")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" slow_query_log_file "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sql_log"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("slowlog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" long_query_time "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xxx 秒 \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" log_queries_not_using_indexes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OFF")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("分析慢查询日志")]),t._v(" "),s("p",[t._v("有两种工具分析慢查询日志，官方的 "),s("code",[t._v("mysqldumpslow")]),t._v(" 工具和第三方 "),s("code",[t._v("pt-query-digest")]),t._v(" 工具。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("mysqldumpslow [opts...] [logs...]")])]),t._v(" "),s("li",[s("code",[t._v("pt-query-digest [options] [files] [dsn]")])])]),t._v(" "),s("hr"),t._v(" "),s("h1",{attrs:{id:"二、执行计划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、执行计划"}},[t._v("#")]),t._v(" 二、执行计划")]),t._v(" "),s("p",[t._v("为什么要关注执行计划")]),t._v(" "),s("ul",[s("li",[t._v("了解 SQL 如何访问表中的数据")]),t._v(" "),s("li",[t._v("了解 SQL 如何使用表中的索引")]),t._v(" "),s("li",[t._v("了解 SQL 所使用的查询类型")])]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPLAIN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" course_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" study_cnt "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" imc_course "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" study_cnt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://z3.ax1x.com/2021/08/11/fdKw4I.png",alt:"image-20210811235755890"}})]),t._v(" "),s("h2",{attrs:{id:"id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#id"}},[t._v("#")]),t._v(" id")]),t._v(" "),s("p",[s("code",[t._v("id")]),t._v(" 表示查询执行的顺序。")]),t._v(" "),s("ul",[s("li",[t._v("id 相同时由上到下执行，id 不同时，由大到小执行")]),t._v(" "),s("li",[t._v("id 为 NULL 表示数据是由另外两个查询进行 union 操作后产生的结果集")])]),t._v(" "),s("p",[t._v("示例一：id 相同的情况")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPLAIN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" course_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" level_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" study_cnt \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" imc_course a \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" imc_class b "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" imc_level c "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("level_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("level_id \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" study_cnt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("；\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://z3.ax1x.com/2021/08/11/fdKdUA.png",alt:"image-20210811235733016"}})]),t._v(" "),s("p",[t._v("示例二：id 不同的情况")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPLAIN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("course_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" imc_course a \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("course_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" course_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" imc_chapter b\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://z3.ax1x.com/2021/08/12/fdKf5n.png",alt:"image-20210812000727550"}})]),t._v(" "),s("h2",{attrs:{id:"select-type"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#select-type"}},[t._v("#")]),t._v(" select_type")]),t._v(" "),s("p",[s("code",[t._v("select_type")]),t._v(" 顾名思义，表示所执行查询的类型。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("值")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("simple")]),t._v(" "),s("td",[t._v("不包含子查询或是 union 操作的查询")])]),t._v(" "),s("tr",[s("td",[t._v("primary")]),t._v(" "),s("td",[t._v("查询中如果包含任何子查询，那么最外层的查询则被标记为 primary")])]),t._v(" "),s("tr",[s("td",[t._v("subquery")]),t._v(" "),s("td",[t._v("select 列表中的子查询")])]),t._v(" "),s("tr",[s("td",[t._v("dependent subquery")]),t._v(" "),s("td",[t._v("依赖外部结果的子查询")])]),t._v(" "),s("tr",[s("td",[t._v("union")]),t._v(" "),s("td",[t._v("union 操作的第二个或是之后的查询的值为 union")])]),t._v(" "),s("tr",[s("td",[t._v("dependent union")]),t._v(" "),s("td",[t._v("当 union 做为子查询时，第二或是第二个后的查询的 select_type 值")])]),t._v(" "),s("tr",[s("td",[t._v("union result")]),t._v(" "),s("td",[t._v("union 产生的结果集")])]),t._v(" "),s("tr",[s("td",[t._v("derived")]),t._v(" "),s("td",[t._v("出现在 from 子句中的子查询")])])])]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPLAIN")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" course_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" level_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" study_cnt \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" imc_course a \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" imc_class b "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" imc_level c "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("level_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("level_id \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" study_cnt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" course_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" level_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" study_cnt\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" imc_course a\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" imc_class b "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" imc_level c "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("level_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("level_id\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" class_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://z3.ax1x.com/2021/08/12/fdMUMT.png",alt:"image-20210812002211211"}})]),t._v(" "),s("p",[t._v("以上例子中，id 为 1 的查询表示 union 操作的第一个查询，类型为 primary；id 为 2 的查询为 union 操作的第二个查询，类型为 union；id 为 null 的查询表示结果是由两个查询的结果集 union 得到的。")]),t._v(" "),s("h2",{attrs:{id:"table"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#table"}},[t._v("#")]),t._v(" table")]),t._v(" "),s("p",[s("code",[t._v("table")]),t._v(" 表示执行计划中，表示是从哪个表中获取数据。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("<unionM，N>")]),t._v(" 表示由 id 为 M，N 查询 union 产生的结果集")]),t._v(" "),s("li",[s("code",[t._v("<derived N>")]),t._v(", "),s("code",[t._v("<subquery N>")]),t._v(" 表示数据从 id 为 N 的查询产生临时表中获取")])]),t._v(" "),s("h2",{attrs:{id:"partitions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#partitions"}},[t._v("#")]),t._v(" partitions")]),t._v(" "),s("p",[s("code",[t._v("partitions")]),t._v(" 只有才查询分区表时才有意义。")]),t._v(" "),s("ul",[s("li",[t._v("对于分区表，显示查询的分区 id")]),t._v(" "),s("li",[t._v("对于非分区表，显示 NULL")])]),t._v(" "),s("h2",{attrs:{id:"type"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#type"}},[t._v("#")]),t._v(" type")]),t._v(" "),s("p",[s("code",[t._v("type")]),t._v(" 表示查询使用的关联类型，性能从高到低如下表所示。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("值")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("system")]),t._v(" "),s("td",[t._v("这是 const 联接类型的一个特例，当查询的表只有一行时使用")])]),t._v(" "),s("tr",[s("td",[t._v("const")]),t._v(" "),s("td",[t._v("表中有且只有一个匹配的行时使用，如对主键或是唯一索引的查询，这是效率最高的联接方式")])]),t._v(" "),s("tr",[s("td",[t._v("eq_ref")]),t._v(" "),s("td",[t._v("唯一索或主键引查找，对于每个索引键，表中只有一条记录与之匹配")])]),t._v(" "),s("tr",[s("td",[t._v("ref")]),t._v(" "),s("td",[t._v("非唯一索引查找，返回匹配某个单独值的所有行")])]),t._v(" "),s("tr",[s("td",[t._v("ref_or_null")]),t._v(" "),s("td",[t._v("类似于 ref 类型的查询，但是附加了对 NULL 值列的查询")])]),t._v(" "),s("tr",[s("td",[t._v("index_merge")]),t._v(" "),s("td",[t._v("该联接类型表示使用了索引合并优化方法")])]),t._v(" "),s("tr",[s("td",[t._v("range")]),t._v(" "),s("td",[t._v("索引范围扫描，常见于 between、>、< 这样的查询条件")])]),t._v(" "),s("tr",[s("td",[t._v("index")]),t._v(" "),s("td",[t._v("FULL Index Scan 全索引扫描，同 ALL 的区别是，遍历的是索引树")])]),t._v(" "),s("tr",[s("td",[t._v("ALL")]),t._v(" "),s("td",[t._v("FULL Table Scan 全表扫描，这是效率最差的联接方式")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("对于 index_merge 类型：")]),t._v(" "),s("p",[t._v("一般情况下 MySQL 在查询中只能使用一个索引，在 MySQL 5.6 之后支持了索引合并，即 MySQL 可以使用多个索引来查询数据后，再进行合并优化。但是从上表中可以看到，这种查询方式性能并不高。")])]),t._v(" "),s("h2",{attrs:{id:"possible-key-key-key-len"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#possible-key-key-key-len"}},[t._v("#")]),t._v(" possible_key，key，key_len")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("possible_key")]),t._v("：表示查询中可能会用到的索引。是基于查询使用的列和过滤条件进行判断的，查询中的列所涉及到的索引都会被列出来，但是未必会被使用到，possible_key 展示了可能用到的索引。")]),t._v(" "),s("li",[s("code",[t._v("key")]),t._v("：表示查询中实际用到的索引。")]),t._v(" "),s("li",[s("code",[t._v("key_len")]),t._v("：表示实际使用索引的最大长度。可以区分联合索引的使用情况，长度是由表中定义的字段长度决定的，如 varchar(20)，并不是行中存储数据的实际长度。这也是强调尽量将字段长度定义的小一些，因为会直接影响到 SQL 执行计划的生成。")])]),t._v(" "),s("h2",{attrs:{id:"ref"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ref"}},[t._v("#")]),t._v(" ref")]),t._v(" "),s("p",[s("code",[t._v("ref")]),t._v(" 表示那些列或常量被用于索引查找。如果查询中没有用到任何索引，则 ref 为 NULL。")]),t._v(" "),s("h2",{attrs:{id:"row"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#row"}},[t._v("#")]),t._v(" row")]),t._v(" "),s("p",[s("code",[t._v("row")]),t._v(" 有两个方面的含义")]),t._v(" "),s("ul",[s("li",[t._v("跟据统计信息预估的扫描的行数。")]),t._v(" "),s("li",[t._v("关联查询中 row 值也代表内嵌循环的次数，在内嵌循环算法中，每获取一个匹配的值，都要对目标表进行一次查找，所以循环次数越多，性能也就越差。")])]),t._v(" "),s("p",[t._v("row 是一个预估值，并不准确。")]),t._v(" "),s("h2",{attrs:{id:"filtered"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filtered"}},[t._v("#")]),t._v(" filtered")]),t._v(" "),s("p",[s("code",[t._v("filtered")]),t._v(" 表示预估返回结果的行数占需扫描行数的百分比。也是一个预估值，所以并不准确，但是可以一定程度上评估查询性能。filtered 的百分比越高表示性能越好。")]),t._v(" "),s("h2",{attrs:{id:"extra"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#extra"}},[t._v("#")]),t._v(" extra")]),t._v(" "),s("p",[s("code",[t._v("extra")]),t._v(" 包含了一些不适合在其他列展示的额外信息，常见的值如下表：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("值")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Distinct")]),t._v(" "),s("td",[t._v("优化 distinct 操作，在找到第一匹配的元组后即停止找同样值的动作。")])]),t._v(" "),s("tr",[s("td",[t._v("Not exists")]),t._v(" "),s("td",[t._v("使用 not exists 来优化查询。")])]),t._v(" "),s("tr",[s("td",[t._v("Using filesort")]),t._v(" "),s("td",[t._v("使用文件来进行排序，通常会出现在 order by 或 group by 查询中。"),s("br"),t._v("这个值的出现表示 MySQL 需要使用外部索引来进行排序，而不是直接按照索引的顺序从表中获取数据的。")])]),t._v(" "),s("tr",[s("td",[t._v("Using index")]),t._v(" "),s("td",[t._v("使用了覆盖索引进行查询。")])]),t._v(" "),s("tr",[s("td",[t._v("Using temporary")]),t._v(" "),s("td",[t._v("MySQL 需要使用临时表来缓存数据，常见于排序，子查询，和分组查询。"),s("br"),t._v("出现了这个值，需要重点关注，因为需要临时表，性能不好。")])]),t._v(" "),s("tr",[s("td",[t._v("Using where")]),t._v(" "),s("td",[t._v("MySQL 服务器层需要使用 WHERE 条件来对获取到的数据进行过滤。")])]),t._v(" "),s("tr",[s("td",[t._v("select tables optimized laway")]),t._v(" "),s("td",[t._v("表示可以直接通过索引来获得数据，不用访问表。")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("覆盖索引：查询所需要的所有信息，都可以通过索引获取，不用回表查询。")])]),t._v(" "),s("p",[t._v("最需要关注的两种：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://z3.ax1x.com/2021/08/17/fIMJcn.png",alt:"image-20210817234228128"}})])])}),[],!1,null,null,null);s.default=r.exports}}]);